<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>لوحة تحكم المسؤول - المحفظة الرقمية</title>
  
  <!-- Firebase SDK -->
  <script src="https://www.gstatic.com/firebasejs/9.6.10/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.6.10/firebase-firestore-compat.js"></script>
  
  <!-- Font Awesome -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
    }

    :root {
      --primary: #006633;
      --secondary: #00cc66;
      --danger: #ff4757;
      --success: #26a17b;
      --warning: #ff9f00;
      --info: #2d87ff;
      --dark: #1a1a1a;
      --light: #f8f9fa;
      --gray: #666;
      --border: rgba(0, 0, 0, 0.1);
    }

    body {
      background: #f5f5f5;
      color: var(--dark);
      min-height: 100vh;
      font-size: 14px;
    }

    /* شاشة تسجيل الدخول */
    .login-container {
      display: flex;
      justify-content: center;
      align-items: center;
      min-height: 100vh;
      background: linear-gradient(135deg, var(--primary), var(--secondary));
    }

    .login-box {
      background: white;
      padding: 30px;
      border-radius: 15px;
      box-shadow: 0 8px 25px rgba(0,0,0,0.15);
      width: 100%;
      max-width: 350px;
      text-align: center;
    }

    .login-logo {
      font-size: 36px;
      color: var(--primary);
      margin-bottom: 15px;
    }

    .login-title {
      font-size: 20px;
      font-weight: 700;
      color: var(--dark);
      margin-bottom: 20px;
    }

    .login-input {
      width: 100%;
      padding: 12px;
      margin-bottom: 15px;
      border: 2px solid var(--border);
      border-radius: 8px;
      font-size: 14px;
      transition: all 0.3s;
    }

    .login-input:focus {
      outline: none;
      border-color: var(--primary);
      box-shadow: 0 0 0 2px rgba(0, 102, 51, 0.1);
    }

    .login-btn {
      width: 100%;
      padding: 12px;
      background: linear-gradient(135deg, var(--primary), var(--secondary));
      color: white;
      border: none;
      border-radius: 8px;
      font-size: 16px;
      font-weight: 700;
      cursor: pointer;
      transition: all 0.3s;
    }

    .login-btn:hover {
      transform: translateY(-1px);
      box-shadow: 0 4px 15px rgba(0,102,51,0.2);
    }

    .login-error {
      color: var(--danger);
      margin-top: 10px;
      font-size: 12px;
      display: none;
    }

    /* لوحة التحكم */
    .admin-container {
      display: none;
      min-height: 100vh;
    }

    .admin-header {
      background: linear-gradient(135deg, var(--primary), var(--secondary));
      color: white;
      padding: 15px 20px;
      display: flex;
      justify-content: space-between;
      align-items: center;
      box-shadow: 0 2px 10px rgba(0,0,0,0.1);
    }

    .admin-header h1 {
      font-size: 18px;
      font-weight: 700;
    }

    .admin-logout {
      background: rgba(255,255,255,0.2);
      border: none;
      color: white;
      padding: 8px 15px;
      border-radius: 6px;
      cursor: pointer;
      font-weight: 600;
      font-size: 13px;
      transition: all 0.3s;
    }

    .admin-logout:hover {
      background: rgba(255,255,255,0.3);
    }

    .admin-content {
      padding: 15px;
      max-width: 1400px;
      margin: 0 auto;
    }

    /* الكروت الإحصائية */
    .stats-container {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
      gap: 15px;
      margin-bottom: 20px;
    }

    .stat-card {
      background: white;
      border-radius: 12px;
      padding: 18px;
      box-shadow: 0 3px 10px rgba(0,0,0,0.06);
      border-top: 4px solid;
      transition: transform 0.3s;
      position: relative;
    }

    .stat-card:hover {
      transform: translateY(-2px);
    }

    .stat-card.balance {
      border-color: var(--info);
    }

    .stat-card.balance-usdt {
      border-color: #26a17b;
    }

    .stat-card.pending {
      border-color: var(--warning);
      cursor: pointer;
      transition: transform 0.3s, box-shadow 0.3s;
    }

    .stat-card.pending:hover {
      transform: translateY(-5px);
      box-shadow: 0 8px 20px rgba(255, 159, 0, 0.2);
    }

    .stat-card.pending:active {
      transform: translateY(-2px);
    }

    .stat-card.approved {
      border-color: var(--success);
      cursor: pointer;
      transition: transform 0.3s, box-shadow 0.3s;
    }

    .stat-card.approved:hover {
      transform: translateY(-5px);
      box-shadow: 0 8px 20px rgba(38, 161, 123, 0.2);
    }

    .stat-card.approved:active {
      transform: translateY(-2px);
    }

    .stat-card.rejected {
      border-color: var(--danger);
      cursor: pointer;
      transition: transform 0.3s, box-shadow 0.3s;
    }

    .stat-card.rejected:hover {
      transform: translateY(-5px);
      box-shadow: 0 8px 20px rgba(255, 71, 87, 0.2);
    }

    .stat-card.rejected:active {
      transform: translateY(-2px);
    }

    .stat-card.total {
      border-color: var(--primary);
    }

    .stat-card.total-withdraw {
      border-color: #F0B90B;
      cursor: pointer;
      transition: transform 0.3s, box-shadow 0.3s;
    }

    .stat-card.total-withdraw:hover {
      transform: translateY(-5px);
      box-shadow: 0 8px 20px rgba(240, 185, 11, 0.2);
    }

    .stat-card.total-withdraw:active {
      transform: translateY(-2px);
    }

    .stat-card.approved-withdraw {
      border-color: var(--success);
      cursor: pointer;
      transition: transform 0.3s, box-shadow 0.3s;
    }

    .stat-card.approved-withdraw:hover {
      transform: translateY(-5px);
      box-shadow: 0 8px 20px rgba(38, 161, 123, 0.2);
    }

    .stat-card.approved-withdraw:active {
      transform: translateY(-2px);
    }

    .stat-card.pending-withdraw {
      border-color: var(--warning);
      cursor: pointer;
      transition: transform 0.3s, box-shadow 0.3s;
    }

    .stat-card.pending-withdraw:hover {
      transform: translateY(-5px);
      box-shadow: 0 8px 20px rgba(255, 159, 0, 0.2);
    }

    .stat-card.pending-withdraw:active {
      transform: translateY(-2px);
    }

    .stat-card.rejected-withdraw {
      border-color: var(--danger);
      cursor: pointer;
      transition: transform 0.3s, box-shadow 0.3s;
    }

    .stat-card.rejected-withdraw:hover {
      transform: translateY(-5px);
      box-shadow: 0 8px 20px rgba(255, 71, 87, 0.2);
    }

    .stat-card.rejected-withdraw:active {
      transform: translateY(-2px);
    }

    .stat-card.pending-withdraw .stat-icon {
      color: var(--warning);
    }

    /* بطاقة الأرصدة المدمجة */
    .stat-card.combined-balance {
      grid-column: span 2;
      border-color: var(--info);
      display: flex;
      flex-direction: column;
    }

    .balance-row {
      display: flex;
      justify-content: space-between;
      margin-bottom: 15px;
    }

    .balance-row:last-child {
      margin-bottom: 0;
    }

    .balance-item {
      flex: 1;
      text-align: center;
      padding: 10px;
      position: relative;
    }

    .balance-item:first-child {
      border-left: 1px solid var(--border);
    }

    .balance-icon {
      font-size: 28px;
      margin-bottom: 8px;
      display: block;
    }

    .balance-item:nth-child(1) .balance-icon {
      color: var(--info);
    }

    .balance-item:nth-child(2) .balance-icon {
      color: #26a17b;
    }

    .balance-value {
      font-size: 22px;
      font-weight: 700;
      margin-bottom: 3px;
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      direction: ltr;
      text-align: center;
    }

    .balance-label {
      color: var(--gray);
      font-size: 12px;
    }

    .stat-icon {
      font-size: 30px;
      margin-bottom: 10px;
    }

    .stat-card.balance .stat-icon {
      color: var(--info);
    }

    .stat-card.balance-usdt .stat-icon {
      color: #26a17b;
    }

    .stat-card.pending .stat-icon {
      color: var(--warning);
    }

    .stat-card.approved .stat-icon {
      color: var(--success);
    }

    .stat-card.rejected .stat-icon {
      color: var(--danger);
    }

    .stat-card.total .stat-icon {
      color: var(--primary);
    }

    .stat-card.total-withdraw .stat-icon {
      color: #F0B90B;
    }

    .stat-card.approved-withdraw .stat-icon {
      color: var(--success);
    }

    .stat-card.rejected-withdraw .stat-icon {
      color: var(--danger);
    }

    .stat-value {
      font-size: 24px;
      font-weight: 700;
      margin-bottom: 3px;
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      direction: ltr;
      text-align: left;
    }

    .stat-label {
      color: var(--gray);
      font-size: 12px;
    }

    /* نافذة تفاصيل الطلب */
    .modal-overlay {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0,0,0,0.5);
      display: none;
      justify-content: center;
      align-items: center;
      z-index: 1000;
      padding: 15px;
    }

    .modal-content {
      background: white;
      border-radius: 15px;
      width: 100%;
      max-width: 500px;
      max-height: 85vh;
      overflow-y: auto;
      box-shadow: 0 15px 40px rgba(0,0,0,0.2);
      animation: modalSlideIn 0.3s ease;
    }

    @keyframes modalSlideIn {
      from {
        opacity: 0;
        transform: translateY(-20px);
      }
      to {
        opacity: 1;
        transform: translateY(0);
      }
    }

    .modal-header {
      background: linear-gradient(135deg, var(--primary), var(--secondary));
      color: white;
      padding: 15px;
      border-radius: 15px 15px 0 0;
      display: flex;
      justify-content: space-between;
      align-items: center;
    }

    .modal-header.binance {
      background: linear-gradient(135deg, #F0B90B, #F0D90B);
      color: #1E2026;
    }

    .modal-close {
      background: none;
      border: none;
      color: white;
      font-size: 20px;
      cursor: pointer;
      width: 30px;
      height: 30px;
      display: flex;
      align-items: center;
      justify-content: center;
      border-radius: 50%;
      transition: all 0.3s;
    }

    .modal-header.binance .modal-close {
      color: #1E2026;
    }

    .modal-close:hover {
      background: rgba(255,255,255,0.2);
    }

    .modal-header.binance .modal-close:hover {
      background: rgba(30, 32, 38, 0.2);
    }

    .modal-body {
      padding: 20px;
    }

    .detail-row {
      display: flex;
      justify-content: space-between;
      margin-bottom: 12px;
      padding-bottom: 12px;
      border-bottom: 1px solid var(--border);
      font-size: 13px;
    }

    .detail-row:last-child {
      border-bottom: none;
      margin-bottom: 0;
      padding-bottom: 0;
    }

    .detail-label {
      color: var(--gray);
      font-weight: 600;
      flex-shrink: 0;
    }

    .detail-value {
      font-weight: 700;
      color: var(--dark);
      text-align: left;
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      direction: ltr;
      max-width: 60%;
      overflow: hidden;
      text-overflow: ellipsis;
    }

    .detail-amount {
      font-size: 18px;
      color: var(--primary);
      font-weight: 700;
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      direction: ltr;
    }

    /* نموذج تأكيد/رفض */
    .action-form {
      margin-top: 20px;
      padding-top: 15px;
      border-top: 1px solid var(--border);
    }

    .form-group {
      margin-bottom: 15px;
    }

    .form-label {
      display: block;
      margin-bottom: 6px;
      font-weight: 600;
      color: var(--dark);
      font-size: 13px;
    }

    .form-textarea {
      width: 100%;
      padding: 12px;
      border: 2px solid var(--border);
      border-radius: 8px;
      font-size: 14px;
      resize: vertical;
      min-height: 80px;
    }

    .form-textarea:focus {
      outline: none;
      border-color: var(--primary);
    }

    .modal-actions {
      display: flex;
      gap: 10px;
      margin-top: 20px;
    }

    .modal-btn {
      flex: 1;
      padding: 12px;
      border: none;
      border-radius: 8px;
      font-size: 14px;
      font-weight: 700;
      cursor: pointer;
      transition: all 0.3s;
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 6px;
    }

    .modal-btn.approve {
      background: linear-gradient(135deg, var(--success), #22c55e);
      color: white;
    }

    .modal-btn.reject {
      background: linear-gradient(135deg, var(--danger), #ff6b6b);
      color: white;
    }

    .modal-btn.cancel {
      background: var(--light);
      color: var(--dark);
      border: 2px solid var(--border);
    }

    /* التحميل */
    .loading {
      display: none;
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(255,255,255,0.9);
      z-index: 2000;
      justify-content: center;
      align-items: center;
      flex-direction: column;
    }

    .loading-spinner {
      width: 40px;
      height: 40px;
      border: 4px solid rgba(0,102,51,0.3);
      border-radius: 50%;
      border-top-color: var(--primary);
      animation: spin 1s linear infinite;
    }

    .loading-text {
      margin-top: 15px;
      font-size: 16px;
      font-weight: 700;
      color: var(--primary);
    }

    @keyframes spin {
      to { transform: rotate(360deg); }
    }

    /* التوست */
    .toast {
      position: fixed;
      bottom: 20px;
      right: 20px;
      background: var(--dark);
      color: white;
      padding: 12px 20px;
      border-radius: 8px;
      box-shadow: 0 8px 20px rgba(0,0,0,0.15);
      display: none;
      align-items: center;
      gap: 8px;
      z-index: 1001;
      animation: toastSlideIn 0.3s ease;
      font-size: 13px;
    }

    @keyframes toastSlideIn {
      from {
        opacity: 0;
        transform: translateX(80px);
      }
      to {
        opacity: 1;
        transform: translateX(0);
      }
    }

    .toast.success {
      background: linear-gradient(135deg, var(--success), #22c55e);
    }

    .toast.error {
      background: linear-gradient(135deg, var(--danger), #ff6b6b);
    }

    .toast.warning {
      background: linear-gradient(135deg, var(--warning), #ffb142);
    }

    .toast.binance {
      background: linear-gradient(135deg, #F0B90B, #F0D90B);
      color: #1E2026;
    }

    /* واجهة جميع طلبات السحب */
    .withdraws-full-container {
      display: none;
      min-height: 100vh;
      background: #f5f5f5;
    }

    .withdraws-full-header {
      background: linear-gradient(135deg, #F0B90B, #F0D90B);
      color: #1E2026;
      padding: 15px 20px;
      display: flex;
      justify-content: space-between;
      align-items: center;
      box-shadow: 0 2px 10px rgba(0,0,0,0.1);
    }

    .withdraws-full-header h1 {
      font-size: 18px;
      font-weight: 700;
      display: flex;
      align-items: center;
      gap: 10px;
    }

    .back-to-dashboard-btn {
      background: rgba(30, 32, 38, 0.2);
      border: none;
      color: #1E2026;
      padding: 8px 15px;
      border-radius: 6px;
      cursor: pointer;
      font-weight: 600;
      font-size: 13px;
      transition: all 0.3s;
      display: flex;
      align-items: center;
      gap: 6px;
    }

    .back-to-dashboard-btn:hover {
      background: rgba(30, 32, 38, 0.3);
    }

    .withdraws-full-content {
      padding: 15px;
      max-width: 1400px;
      margin: 0 auto;
    }

    /* واجهة جميع طلبات الإيداع المرفوضة */
    .rejected-deposits-full-container {
      display: none;
      min-height: 100vh;
      background: #f5f5f5;
    }

    .rejected-deposits-full-header {
      background: linear-gradient(135deg, var(--danger), #ff6b6b);
      color: white;
      padding: 15px 20px;
      display: flex;
      justify-content: space-between;
      align-items: center;
      box-shadow: 0 2px 10px rgba(0,0,0,0.1);
    }

    .rejected-deposits-full-header h1 {
      font-size: 18px;
      font-weight: 700;
      display: flex;
      align-items: center;
      gap: 10px;
    }

    .rejected-deposits-full-content {
      padding: 15px;
      max-width: 1400px;
      margin: 0 auto;
    }

    /* واجهة جميع طلبات الإيداع قيد الانتظار */
    .pending-deposits-full-container {
      display: none;
      min-height: 100vh;
      background: #f5f5f5;
    }

    .pending-deposits-full-header {
      background: linear-gradient(135deg, var(--warning), #ffb142);
      color: white;
      padding: 15px 20px;
      display: flex;
      justify-content: space-between;
      align-items: center;
      box-shadow: 0 2px 10px rgba(0,0,0,0.1);
    }

    .pending-deposits-full-header h1 {
      font-size: 18px;
      font-weight: 700;
      display: flex;
      align-items: center;
      gap: 10px;
    }

    .pending-deposits-full-content {
      padding: 15px;
      max-width: 1400px;
      margin: 0 auto;
    }

    /* واجهة جميع طلبات الإيداع المؤكدة */
    .approved-deposits-full-container {
      display: none;
      min-height: 100vh;
      background: #f5f5f5;
    }

    .approved-deposits-full-header {
      background: linear-gradient(135deg, var(--success), #22c55e);
      color: white;
      padding: 15px 20px;
      display: flex;
      justify-content: space-between;
      align-items: center;
      box-shadow: 0 2px 10px rgba(0,0,0,0.1);
    }

    .approved-deposits-full-header h1 {
      font-size: 18px;
      font-weight: 700;
      display: flex;
      align-items: center;
      gap: 10px;
    }

    .approved-deposits-full-content {
      padding: 15px;
      max-width: 1400px;
      margin: 0 auto;
    }

    /* واجهة جميع طلبات السحب المؤكدة */
    .approved-withdraws-full-container {
      display: none;
      min-height: 100vh;
      background: #f5f5f5;
    }

    .approved-withdraws-full-header {
      background: linear-gradient(135deg, var(--success), #22c55e);
      color: white;
      padding: 15px 20px;
      display: flex;
      justify-content: space-between;
      align-items: center;
      box-shadow: 0 2px 10px rgba(0,0,0,0.1);
    }

    .approved-withdraws-full-header h1 {
      font-size: 18px;
      font-weight: 700;
      display: flex;
      align-items: center;
      gap: 10px;
    }

    .approved-withdraws-full-content {
      padding: 15px;
      max-width: 1400px;
      margin: 0 auto;
    }

    /* واجهة جميع طلبات السحب قيد الانتظار */
    .pending-withdraws-full-container {
      display: none;
      min-height: 100vh;
      background: #f5f5f5;
    }

    .pending-withdraws-full-header {
      background: linear-gradient(135deg, var(--warning), #ffb142);
      color: white;
      padding: 15px 20px;
      display: flex;
      justify-content: space-between;
      align-items: center;
      box-shadow: 0 2px 10px rgba(0,0,0,0.1);
    }

    .pending-withdraws-full-header h1 {
      font-size: 18px;
      font-weight: 700;
      display: flex;
      align-items: center;
      gap: 10px;
    }

    .pending-withdraws-full-content {
      padding: 15px;
      max-width: 1400px;
      margin: 0 auto;
    }

    /* واجهة جميع طلبات السحب المرفوضة */
    .rejected-withdraws-full-container {
      display: none;
      min-height: 100vh;
      background: #f5f5f5;
    }

    .rejected-withdraws-full-header {
      background: linear-gradient(135deg, var(--danger), #ff6b6b);
      color: white;
      padding: 15px 20px;
      display: flex;
      justify-content: space-between;
      align-items: center;
      box-shadow: 0 2px 10px rgba(0,0,0,0.1);
    }

    .rejected-withdraws-full-header h1 {
      font-size: 18px;
      font-weight: 700;
      display: flex;
      align-items: center;
      gap: 10px;
    }

    .rejected-withdraws-full-content {
      padding: 15px;
      max-width: 1400px;
      margin: 0 auto;
    }

    /* الفلاتر */
    .filters-container {
      background: white;
      border-radius: 12px;
      padding: 15px;
      margin-bottom: 20px;
      box-shadow: 0 3px 10px rgba(0,0,0,0.06);
    }

    .filters-title {
      font-size: 16px;
      font-weight: 700;
      margin-bottom: 12px;
      color: var(--primary);
    }

    .filter-buttons {
      display: flex;
      gap: 8px;
      flex-wrap: wrap;
    }

    .filter-btn {
      padding: 8px 15px;
      border: 1px solid var(--border);
      background: white;
      border-radius: 8px;
      cursor: pointer;
      font-weight: 600;
      font-size: 13px;
      transition: all 0.3s;
    }

    .filter-btn.active {
      background: var(--primary);
      color: white;
      border-color: var(--primary);
    }

    .filter-btn.pending {
      background: rgba(255, 193, 7, 0.1);
      color: #ff9800;
      border-color: rgba(255, 193, 7, 0.2);
    }

    .filter-btn.pending.active {
      background: #ff9800;
      color: white;
      border-color: #ff9800;
    }

    .filter-btn.approved {
      background: rgba(76, 175, 80, 0.1);
      color: #4caf50;
      border-color: rgba(76, 175, 80, 0.2);
    }

    .filter-btn.approved.active {
      background: #4caf50;
      color: white;
      border-color: #4caf50;
    }

    .filter-btn.rejected {
      background: rgba(244, 67, 54, 0.1);
      color: #f44336;
      border-color: rgba(244, 67, 54, 0.2);
    }

    .filter-btn.rejected.active {
      background: #f44336;
      color: white;
      border-color: #f44336;
    }

    .filter-btn.binance {
      background: rgba(240, 185, 11, 0.1);
      color: #F0B90B;
      border-color: rgba(240, 185, 11, 0.2);
    }

    .filter-btn.binance.active {
      background: #F0B90B;
      color: #1E2026;
      border-color: #F0B90B;
    }

    /* قائمة الطلبات العمودية */
    .requests-list-container {
      background: white;
      border-radius: 12px;
      padding: 15px;
      box-shadow: 0 3px 10px rgba(0,0,0,0.06);
    }

    .requests-list-title {
      font-size: 16px;
      font-weight: 700;
      margin-bottom: 15px;
      color: var(--primary);
      display: flex;
      align-items: center;
      gap: 8px;
    }

    .requests-list {
      display: flex;
      flex-direction: column;
      gap: 12px;
    }

    .request-card {
      background: var(--light);
      border-radius: 10px;
      padding: 15px;
      border-left: 4px solid;
      transition: all 0.3s;
      border: 1px solid var(--border);
      position: relative;
    }

    .request-card:hover {
      transform: translateY(-2px);
      box-shadow: 0 4px 12px rgba(0,0,0,0.08);
    }

    .request-card.pending {
      border-left-color: var(--warning);
    }

    .request-card.approved {
      border-left-color: var(--success);
    }

    .request-card.rejected {
      border-left-color: var(--danger);
    }

    .request-header {
      display: flex;
      justify-content: space-between;
      align-items: flex-start;
      margin-bottom: 12px;
      padding-bottom: 10px;
      border-bottom: 1px solid var(--border);
    }

    .request-id {
      font-family: 'Courier New', monospace;
      font-size: 12px;
      color: var(--gray);
      background: white;
      padding: 4px 8px;
      border-radius: 4px;
      border: 1px solid var(--border);
    }

    .request-status {
      padding: 4px 10px;
      border-radius: 15px;
      font-size: 11px;
      font-weight: 600;
    }

    .status-pending {
      background: rgba(255, 193, 7, 0.1);
      color: #ff9800;
      border: 1px solid rgba(255, 193, 7, 0.2);
    }

    .status-approved {
      background: rgba(76, 175, 80, 0.1);
      color: #4caf50;
      border: 1px solid rgba(76, 175, 80, 0.2);
    }

    .status-rejected {
      background: rgba(244, 67, 54, 0.1);
      color: #f44336;
      border: 1px solid rgba(244, 67, 54, 0.2);
    }

    .request-content {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(180px, 1fr));
      gap: 10px;
      margin-bottom: 15px;
    }

    .request-info {
      background: white;
      padding: 12px;
      border-radius: 8px;
      border: 1px solid var(--border);
    }

    .info-label {
      font-size: 11px;
      color: var(--gray);
      margin-bottom: 6px;
      display: flex;
      align-items: center;
      gap: 6px;
    }

    .info-value {
      font-size: 14px;
      font-weight: 600;
      color: var(--dark);
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      direction: ltr;
      text-align: left;
    }

    .info-amount {
      font-size: 18px;
      font-weight: 700;
      color: var(--primary);
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      direction: ltr;
      text-align: left;
    }

    .info-user {
      display: flex;
      align-items: center;
      gap: 8px;
    }

    .user-avatar {
      width: 32px;
      height: 32px;
      background: linear-gradient(135deg, var(--primary), var(--secondary));
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      color: white;
      font-weight: 700;
      font-size: 13px;
      flex-shrink: 0;
    }

    .user-avatar.binance {
      background: linear-gradient(135deg, #F0B90B, #F0D90B);
    }

    .user-info {
      display: flex;
      flex-direction: column;
      overflow: hidden;
    }

    .user-name {
      font-weight: 700;
      font-size: 14px;
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
    }

    .user-id {
      font-size: 11px;
      color: var(--gray);
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      direction: ltr;
      text-align: left;
    }

    .request-actions {
      display: flex;
      gap: 8px;
      margin-top: 15px;
      padding-top: 15px;
      border-top: 1px solid var(--border);
    }

    .action-btn {
      padding: 8px 15px;
      border: none;
      border-radius: 6px;
      cursor: pointer;
      font-weight: 600;
      font-size: 12px;
      transition: all 0.3s;
      display: flex;
      align-items: center;
      gap: 6px;
      flex: 1;
      justify-content: center;
    }

    .action-btn.view {
      background: linear-gradient(135deg, var(--info), #4299e1);
      color: white;
    }

    .action-btn.approve {
      background: linear-gradient(135deg, var(--success), #22c55e);
      color: white;
    }

    .action-btn.reject {
      background: linear-gradient(135deg, var(--danger), #ff6b6b);
      color: white;
    }

    .action-btn.binance {
      background: linear-gradient(135deg, #F0B90B, #F0D90B);
      color: #1E2026;
    }

    .action-btn:hover {
      transform: translateY(-1px);
      box-shadow: 0 3px 8px rgba(0,0,0,0.1);
    }

    /* البحث */
    .search-container {
      margin-bottom: 15px;
      position: relative;
    }

    .search-input {
      width: 100%;
      padding: 12px 40px 12px 12px;
      border: 2px solid var(--border);
      border-radius: 8px;
      font-size: 14px;
      transition: all 0.3s;
    }

    .search-input:focus {
      outline: none;
      border-color: var(--primary);
      box-shadow: 0 0 0 2px rgba(0, 102, 51, 0.1);
    }

    .search-icon {
      position: absolute;
      left: 12px;
      top: 50%;
      transform: translateY(-50%);
      color: var(--gray);
      font-size: 14px;
    }

    /* حالة عدم وجود طلبات */
    .no-requests {
      text-align: center;
      padding: 40px 15px;
      color: var(--gray);
    }

    .no-requests-icon {
      font-size: 48px;
      margin-bottom: 15px;
      opacity: 0.5;
    }

    .no-requests-title {
      font-size: 16px;
      font-weight: 600;
      margin-bottom: 8px;
    }

    .no-requests-text {
      font-size: 14px;
    }

    /* التجاوب */
    @media (max-width: 768px) {
      .admin-content {
        padding: 10px;
      }
      
      .stats-container {
        grid-template-columns: 1fr;
      }
      
      .stat-card.combined-balance {
        grid-column: span 1;
      }
      
      .balance-row {
        flex-direction: column;
      }
      
      .balance-item {
        border-left: none !important;
        border-bottom: 1px solid var(--border);
        padding: 12px 0;
      }
      
      .balance-item:last-child {
        border-bottom: none;
      }
      
      .modal-content {
        margin: 10px;
      }
      
      .request-content {
        grid-template-columns: 1fr;
      }
      
      .request-actions {
        flex-direction: column;
      }
      
      .filter-buttons {
        justify-content: center;
      }
      
      .toast {
        left: 15px;
        right: 15px;
        bottom: 15px;
      }
      
      .request-header {
        flex-direction: column;
        gap: 8px;
        align-items: flex-start;
      }
      
      .withdraws-full-content {
        padding: 10px;
      }
      
      .rejected-deposits-full-content {
        padding: 10px;
      }
      
      .pending-deposits-full-content {
        padding: 10px;
      }
      
      .approved-deposits-full-content {
        padding: 10px;
      }
      
      .approved-withdraws-full-content {
        padding: 10px;
      }
      
      .pending-withdraws-full-content {
        padding: 10px;
      }
      
      .rejected-withdraws-full-content {
        padding: 10px;
      }
    }

    @media (max-width: 480px) {
      .login-box {
        padding: 20px 15px;
        margin: 15px;
      }
      
      .stat-card {
        padding: 15px;
      }
      
      .modal-body {
        padding: 15px;
      }
      
      .modal-actions {
        flex-direction: column;
      }
      
      .balance-value {
        font-size: 20px;
      }
    }
  </style>
</head>
<body>
  <!-- شاشة تسجيل الدخول -->
  <div id="loginContainer" class="login-container">
    <div class="login-box">
      <div class="login-logo">
        <i class="fas fa-user-shield"></i>
      </div>
      
      <h1 class="login-title">لوحة تحكم المسؤول</h1>
      
      <input type="text" id="usernameInput" class="login-input" placeholder="اسم المستخدم" required>
      
      <input type="password" id="passwordInput" class="login-input" placeholder="كلمة المرور" required>
      
      <button id="loginBtn" class="login-btn">
        <i class="fas fa-sign-in-alt"></i>
        تسجيل الدخول
      </button>
      
      <div id="loginError" class="login-error">
        <i class="fas fa-exclamation-circle"></i>
        اسم المستخدم أو كلمة المرور غير صحيحة
      </div>
    </div>
  </div>

  <!-- لوحة التحكم -->
  <div id="adminContainer" class="admin-container">
    <!-- الرأس -->
    <header class="admin-header">
      <h1>
        <i class="fas fa-tachometer-alt"></i>
        لوحة تحكم المسؤول
      </h1>
      
      <button id="logoutBtn" class="admin-logout">
        <i class="fas fa-sign-out-alt"></i>
        تسجيل الخروج
      </button>
    </header>

    <!-- المحتوى الرئيسي -->
    <main class="admin-content">
      <!-- الإحصائيات -->
      <div class="stats-container">
        <!-- بطاقة الأرصدة المدمجة -->
        <div class="stat-card combined-balance">
          <div class="balance-row">
            <div class="balance-item">
              <i class="fas fa-wallet balance-icon"></i>
              <div class="balance-value" id="totalBalanceDZD">0</div>
              <div class="balance-label">إجمالي أرصدة DZD</div>
            </div>
            <div class="balance-item">
              <i class="fas fa-coins balance-icon"></i>
              <div class="balance-value" id="totalBalanceUSDT">0</div>
              <div class="balance-label">إجمالي أرصدة USDT</div>
            </div>
          </div>
        </div>
        
        <div class="stat-card pending" id="totalPendingCard">
          <div class="stat-icon">
            <i class="fas fa-clock"></i>
          </div>
          <div class="stat-value" id="pendingDepositCount">0</div>
          <div class="stat-label">طلبات الإيداع قيد الانتظار</div>
        </div>
        
        <div class="stat-card approved" id="totalApprovedCard">
          <div class="stat-icon">
            <i class="fas fa-check-circle"></i>
          </div>
          <div class="stat-value" id="approvedDepositCount">0</div>
          <div class="stat-label">طلبات الإيداع مؤكدة</div>
        </div>
        
        <div class="stat-card rejected" id="totalRejectedCard">
          <div class="stat-icon">
            <i class="fas fa-times-circle"></i>
          </div>
          <div class="stat-value" id="rejectedDepositCount">0</div>
          <div class="stat-label">طلبات الإيداع مرفوضة</div>
        </div>
        
        <!-- بطاقة طلبات السحب المؤكدة -->
        <div class="stat-card approved-withdraw" id="totalApprovedWithdrawCard">
          <div class="stat-icon">
            <i class="fab fa-binance"></i>
          </div>
          <div class="stat-value" id="approvedWithdrawCount">0</div>
          <div class="stat-label">طلبات السحب مؤكدة</div>
        </div>
        
        <!-- بطاقة طلبات السحب قيد الانتظار الجديدة -->
        <div class="stat-card pending-withdraw" id="totalPendingWithdrawCard">
          <div class="stat-icon">
            <i class="fas fa-clock"></i>
          </div>
          <div class="stat-value" id="pendingWithdrawCount">0</div>
          <div class="stat-label">طلبات السحب قيد الانتظار</div>
        </div>
        
        <!-- بطاقة طلبات السحب المرفوضة الجديدة -->
        <div class="stat-card rejected-withdraw" id="totalRejectedWithdrawCard">
          <div class="stat-icon">
            <i class="fas fa-times-circle"></i>
          </div>
          <div class="stat-value" id="rejectedWithdrawCount">0</div>
          <div class="stat-label">طلبات السحب مرفوضة</div>
        </div>
      </div>
    </main>
  </div>

  <!-- واجهة جميع طلبات السحب -->
  <div id="allWithdrawsContainer" class="withdraws-full-container">
    <!-- الرأس -->
    <header class="withdraws-full-header">
      <h1>
        <i class="fab fa-binance"></i>
        جميع طلبات السحب
      </h1>
      
      <button id="backToDashboardBtn" class="back-to-dashboard-btn">
        <i class="fas fa-arrow-right"></i>
        العودة للوحة التحكم
      </button>
    </header>

    <!-- المحتوى الرئيسي -->
    <main class="withdraws-full-content">
      <!-- الفلاتر والبحث لطلبات السحب -->
      <div class="filters-container">
        <h2 class="filters-title" style="color: #F0B90B;">
          <i class="fab fa-binance"></i>
          تصفية طلبات السحب إلى Binance
        </h2>
        
        <div class="filter-buttons">
          <button class="filter-btn binance active" data-filter="all" data-type="withdraw">
            <i class="fas fa-list"></i>
            جميع الطلبات
          </button>
          <button class="filter-btn binance pending" data-filter="pending" data-type="withdraw">
            <i class="fas fa-clock"></i>
            قيد الانتظار
          </button>
          <button class="filter-btn binance approved" data-filter="approved" data-type="withdraw">
            <i class="fas fa-check-circle"></i>
            مؤكدة
          </button>
          <button class="filter-btn binance rejected" data-filter="rejected" data-type="withdraw">
            <i class="fas fa-times-circle"></i>
            مرفوضة
          </button>
        </div>
        
        <div class="search-container" style="margin-top: 15px;">
          <i class="fas fa-search search-icon"></i>
          <input type="text" id="allWithdrawsSearchInput" class="search-input" placeholder="ابحث برقم الطلب أو اسم المستخدم أو معرف Binance...">
        </div>
      </div>

      <!-- قائمة طلبات السحب -->
      <div class="requests-list-container">
        <div class="requests-list" id="allWithdrawsList">
          <!-- سيتم ملؤها ديناميكياً -->
        </div>
      </div>
    </main>
  </div>

  <!-- واجهة جميع طلبات الإيداع المرفوضة -->
  <div id="allRejectedDepositsContainer" class="rejected-deposits-full-container">
    <!-- الرأس -->
    <header class="rejected-deposits-full-header">
      <h1>
        <i class="fas fa-times-circle"></i>
        جميع طلبات الإيداع المرفوضة
      </h1>
      
      <button id="backToDashboardFromRejectedBtn" class="back-to-dashboard-btn">
        <i class="fas fa-arrow-right"></i>
        العودة للوحة التحكم
      </button>
    </header>

    <!-- المحتوى الرئيسي -->
    <main class="rejected-deposits-full-content">
      <!-- الفلاتر والبحث لطلبات الإيداع المرفوضة -->
      <div class="filters-container">
        <h2 class="filters-title" style="color: var(--danger);">
          <i class="fas fa-times-circle"></i>
          تصفية طلبات الإيداع المرفوضة
        </h2>
        
        <div class="filter-buttons">
          <button class="filter-btn rejected active" data-filter="rejected" data-type="all-rejected-deposits">
            <i class="fas fa-list"></i>
            جميع الطلبات المرفوضة
          </button>
        </div>
        
        <div class="search-container" style="margin-top: 15px;">
          <i class="fas fa-search search-icon"></i>
          <input type="text" id="allRejectedDepositsSearchInput" class="search-input" placeholder="ابحث برقم الطلب أو اسم المستخدم أو رقم العملية...">
        </div>
      </div>

      <!-- قائمة طلبات الإيداع المرفوضة -->
      <div class="requests-list-container">
        <div class="requests-list" id="allRejectedDepositsList">
          <!-- سيتم ملؤها ديناميكياً -->
        </div>
      </div>
    </main>
  </div>

  <!-- واجهة جميع طلبات الإيداع قيد الانتظار -->
  <div id="allPendingDepositsContainer" class="pending-deposits-full-container">
    <!-- الرأس -->
    <header class="pending-deposits-full-header">
      <h1>
        <i class="fas fa-clock"></i>
        جميع طلبات الإيداع قيد الانتظار
      </h1>
      
      <button id="backToDashboardFromPendingBtn" class="back-to-dashboard-btn">
        <i class="fas fa-arrow-right"></i>
        العودة للوحة التحكم
      </button>
    </header>

    <!-- المحتوى الرئيسي -->
    <main class="pending-deposits-full-content">
      <!-- الفلاتر والبحث لطلبات الإيداع قيد الانتظار -->
      <div class="filters-container">
        <h2 class="filters-title" style="color: var(--warning);">
          <i class="fas fa-clock"></i>
          تصفية طلبات الإيداع قيد الانتظار
        </h2>
        
        <div class="filter-buttons">
          <button class="filter-btn pending active" data-filter="pending" data-type="all-pending-deposits">
            <i class="fas fa-list"></i>
            جميع الطلبات قيد الانتظار
          </button>
        </div>
        
        <div class="search-container" style="margin-top: 15px;">
          <i class="fas fa-search search-icon"></i>
          <input type="text" id="allPendingDepositsSearchInput" class="search-input" placeholder="ابحث برقم الطلب أو اسم المستخدم أو رقم العملية...">
        </div>
      </div>

      <!-- قائمة طلبات الإيداع قيد الانتظار -->
      <div class="requests-list-container">
        <div class="requests-list" id="allPendingDepositsList">
          <!-- سيتم ملؤها ديناميكياً -->
        </div>
      </div>
    </main>
  </div>

  <!-- واجهة جميع طلبات الإيداع المؤكدة -->
  <div id="allApprovedDepositsContainer" class="approved-deposits-full-container">
    <!-- الرأس -->
    <header class="approved-deposits-full-header">
      <h1>
        <i class="fas fa-check-circle"></i>
        جميع طلبات الإيداع المؤكدة
      </h1>
      
      <button id="backToDashboardFromApprovedBtn" class="back-to-dashboard-btn">
        <i class="fas fa-arrow-right"></i>
        العودة للوحة التحكم
      </button>
    </header>

    <!-- المحتوى الرئيسي -->
    <main class="approved-deposits-full-content">
      <!-- الفلاتر والبحث لطلبات الإيداع المؤكدة -->
      <div class="filters-container">
        <h2 class="filters-title" style="color: var(--success);">
          <i class="fas fa-check-circle"></i>
          تصفية طلبات الإيداع المؤكدة
        </h2>
        
        <div class="filter-buttons">
          <button class="filter-btn approved active" data-filter="approved" data-type="all-approved-deposits">
            <i class="fas fa-list"></i>
            جميع الطلبات المؤكدة
          </button>
        </div>
        
        <div class="search-container" style="margin-top: 15px;">
          <i class="fas fa-search search-icon"></i>
          <input type="text" id="allApprovedDepositsSearchInput" class="search-input" placeholder="ابحث برقم الطلب أو اسم المستخدم أو رقم العملية...">
        </div>
      </div>

      <!-- قائمة طلبات الإيداع المؤكدة -->
      <div class="requests-list-container">
        <div class="requests-list" id="allApprovedDepositsList">
          <!-- سيتم ملؤها ديناميكياً -->
        </div>
      </div>
    </main>
  </div>

  <!-- واجهة جميع طلبات السحب المؤكدة -->
  <div id="allApprovedWithdrawsContainer" class="approved-withdraws-full-container">
    <!-- الرأس -->
    <header class="approved-withdraws-full-header">
      <h1>
        <i class="fab fa-binance"></i>
        جميع طلبات السحب المؤكدة
      </h1>
      
      <button id="backToDashboardFromApprovedWithdrawBtn" class="back-to-dashboard-btn">
        <i class="fas fa-arrow-right"></i>
        العودة للوحة التحكم
      </button>
    </header>

    <!-- المحتوى الرئيسي -->
    <main class="approved-withdraws-full-content">
      <!-- الفلاتر والبحث لطلبات السحب المؤكدة -->
      <div class="filters-container">
        <h2 class="filters-title" style="color: var(--success);">
          <i class="fab fa-binance"></i>
          تصفية طلبات السحب المؤكدة إلى Binance
        </h2>
        
        <div class="filter-buttons">
          <button class="filter-btn binance approved active" data-filter="approved" data-type="all-approved-withdraws">
            <i class="fas fa-list"></i>
            جميع الطلبات المؤكدة
          </button>
        </div>
        
        <div class="search-container" style="margin-top: 15px;">
          <i class="fas fa-search search-icon"></i>
          <input type="text" id="allApprovedWithdrawsSearchInput" class="search-input" placeholder="ابحث برقم الطلب أو اسم المستخدم أو معرف Binance...">
        </div>
      </div>

      <!-- قائمة طلبات السحب المؤكدة -->
      <div class="requests-list-container">
        <div class="requests-list" id="allApprovedWithdrawsList">
          <!-- سيتم ملؤها ديناميكياً -->
        </div>
      </div>
    </main>
  </div>

  <!-- واجهة جميع طلبات السحب قيد الانتظار -->
  <div id="allPendingWithdrawsContainer" class="pending-withdraws-full-container">
    <!-- الرأس -->
    <header class="pending-withdraws-full-header">
      <h1>
        <i class="fas fa-clock"></i>
        جميع طلبات السحب قيد الانتظار
      </h1>
      
      <button id="backToDashboardFromPendingWithdrawBtn" class="back-to-dashboard-btn">
        <i class="fas fa-arrow-right"></i>
        العودة للوحة التحكم
      </button>
    </header>

    <!-- المحتوى الرئيسي -->
    <main class="pending-withdraws-full-content">
      <!-- الفلاتر والبحث لطلبات السحب قيد الانتظار -->
      <div class="filters-container">
        <h2 class="filters-title" style="color: var(--warning);">
          <i class="fas fa-clock"></i>
          تصفية طلبات السحب قيد الانتظار
        </h2>
        
        <div class="filter-buttons">
          <button class="filter-btn binance pending active" data-filter="pending" data-type="all-pending-withdraws">
            <i class="fas fa-clock"></i>
            جميع الطلبات قيد الانتظار
          </button>
        </div>
        
        <div class="search-container" style="margin-top: 15px;">
          <i class="fas fa-search search-icon"></i>
          <input type="text" id="allPendingWithdrawsSearchInput" class="search-input" placeholder="ابحث برقم الطلب أو اسم المستخدم أو معرف Binance...">
        </div>
      </div>

      <!-- قائمة طلبات السحب قيد الانتظار -->
      <div class="requests-list-container">
        <div class="requests-list" id="allPendingWithdrawsList">
          <!-- سيتم ملؤها ديناميكياً -->
        </div>
      </div>
    </main>
  </div>

  <!-- واجهة جميع طلبات السحب المرفوضة -->
  <div id="allRejectedWithdrawsContainer" class="rejected-withdraws-full-container">
    <!-- الرأس -->
    <header class="rejected-withdraws-full-header">
      <h1>
        <i class="fas fa-times-circle"></i>
        جميع طلبات السحب المرفوضة
      </h1>
      
      <button id="backToDashboardFromRejectedWithdrawBtn" class="back-to-dashboard-btn">
        <i class="fas fa-arrow-right"></i>
        العودة للوحة التحكم
      </button>
    </header>

    <!-- المحتوى الرئيسي -->
    <main class="rejected-withdraws-full-content">
      <!-- الفلاتر والبحث لطلبات السحب المرفوضة -->
      <div class="filters-container">
        <h2 class="filters-title" style="color: var(--danger);">
          <i class="fas fa-times-circle"></i>
          تصفية طلبات السحب المرفوضة
        </h2>
        
        <div class="filter-buttons">
          <button class="filter-btn binance rejected active" data-filter="rejected" data-type="all-rejected-withdraws">
            <i class="fas fa-times-circle"></i>
            جميع الطلبات المرفوضة
          </button>
        </div>
        
        <div class="search-container" style="margin-top: 15px;">
          <i class="fas fa-search search-icon"></i>
          <input type="text" id="allRejectedWithdrawsSearchInput" class="search-input" placeholder="ابحث برقم الطلب أو اسم المستخدم أو معرف Binance...">
        </div>
      </div>

      <!-- قائمة طلبات السحب المرفوضة -->
      <div class="requests-list-container">
        <div class="requests-list" id="allRejectedWithdrawsList">
          <!-- سيتم ملؤها ديناميكياً -->
        </div>
      </div>
    </main>
  </div>

  <!-- نافذة تفاصيل طلب الإيداع -->
  <div id="depositRequestModal" class="modal-overlay">
    <div class="modal-content">
      <div class="modal-header">
        <h2 style="font-size: 16px; font-weight: 700;">
          <i class="fas fa-file-alt"></i>
          تفاصيل طلب الإيداع
        </h2>
        <button id="closeDepositModalBtn" class="modal-close">&times;</button>
      </div>
      
      <div class="modal-body">
        <div class="detail-row">
          <span class="detail-label">رقم الطلب:</span>
          <span class="detail-value" id="depositModalRequestId">-</span>
        </div>
        
        <div class="detail-row">
          <span class="detail-label">اسم المستخدم:</span>
          <span class="detail-value" id="depositModalUserName">-</span>
        </div>
        
        <div class="detail-row">
          <span class="detail-label">معرف المستخدم:</span>
          <span class="detail-value" id="depositModalUserId">-</span>
        </div>
        
        <div class="detail-row">
          <span class="detail-label">المبلغ:</span>
          <span class="detail-amount" id="depositModalAmount">-</span>
        </div>
        
        <div class="detail-row">
          <span class="detail-label">نوع التحويل:</span>
          <span class="detail-value" id="depositModalTransferType">-</span>
        </div>
        
        <div class="detail-row">
          <span class="detail-label">رقم العملية:</span>
          <span class="detail-value" id="depositModalTransactionNumber">-</span>
        </div>
        
        <div class="detail-row">
          <span class="detail-label">ملاحظات المستخدم:</span>
          <span class="detail-value" id="depositModalUserNotes">لا توجد</span>
        </div>
        
        <div class="detail-row">
          <span class="detail-label">تاريخ الطلب:</span>
          <span class="detail-value" id="depositModalCreatedAt">-</span>
        </div>
        
        <div class="detail-row">
          <span class="detail-label">آخر تحديث:</span>
          <span class="detail-value" id="depositModalUpdatedAt">-</span>
        </div>
        
        <div class="detail-row">
          <span class="detail-label">الحالة الحالية:</span>
          <span id="depositModalStatus" class="status-badge">-</span>
        </div>
        
        <!-- ملاحظات المسؤول (إذا كانت موجودة) -->
        <div id="depositAdminNotesSection" style="display: none; margin-top: 15px; padding: 12px; background: var(--light); border-radius: 8px;">
          <div class="detail-label" style="margin-bottom: 8px;">ملاحظات المسؤول:</div>
          <div id="depositModalAdminNotes" style="color: var(--dark);"></div>
        </div>
        
        <!-- نموذج الإجراء (يظهر فقط للطلبات pending) -->
        <div id="depositActionForm" class="action-form">
          <div class="form-group">
            <label for="depositAdminNotesInput" class="form-label">
              <i class="fas fa-sticky-note"></i>
              ملاحظات المسؤول (اختياري)
            </label>
            <textarea id="depositAdminNotesInput" class="form-textarea" placeholder="أدخل ملاحظاتك هنا..."></textarea>
          </div>
          
          <div class="modal-actions">
            <button id="cancelDepositActionBtn" class="modal-btn cancel">
              <i class="fas fa-times"></i>
              إلغاء
            </button>
            <button id="rejectDepositRequestBtn" class="modal-btn reject">
              <i class="fas fa-times-circle"></i>
              رفض الطلب
            </button>
            <button id="approveDepositRequestBtn" class="modal-btn approve">
              <i class="fas fa-check-circle"></i>
              تأكيد الطلب
            </button>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- نافذة تفاصيل طلب السحب -->
  <div id="withdrawRequestModal" class="modal-overlay">
    <div class="modal-content">
      <div class="modal-header binance">
        <h2 style="font-size: 16px; font-weight: 700;">
          <i class="fab fa-binance"></i>
          تفاصيل طلب السحب إلى Binance
        </h2>
        <button id="closeWithdrawModalBtn" class="modal-close">&times;</button>
      </div>
      
      <div class="modal-body">
        <div class="detail-row">
          <span class="detail-label">رقم الطلب:</span>
          <span class="detail-value" id="withdrawModalRequestId">-</span>
        </div>
        
        <div class="detail-row">
          <span class="detail-label">اسم المستخدم:</span>
          <span class="detail-value" id="withdrawModalUserName">-</span>
        </div>
        
        <div class="detail-row">
          <span class="detail-label">معرف المستخدم:</span>
          <span class="detail-value" id="withdrawModalUserId">-</span>
        </div>
        
        <div class="detail-row">
          <span class="detail-label">المبلغ:</span>
          <span class="detail-amount" id="withdrawModalAmount">-</span>
        </div>
        
        <div class="detail-row">
          <span class="detail-label">الرسوم:</span>
          <span class="detail-value" id="withdrawModalFees">-</span>
        </div>
        
        <div class="detail-row">
          <span class="detail-label">المبلغ الصافي:</span>
          <span class="detail-amount" id="withdrawModalNetAmount">-</span>
        </div>
        
        <div class="detail-row">
          <span class="detail-label">معرف Binance:</span>
          <span class="detail-value" id="withdrawModalBinanceId">-</span>
        </div>
        
        <div class="detail-row">
          <span class="detail-label">تاريخ الطلب:</span>
          <span class="detail-value" id="withdrawModalCreatedAt">-</span>
        </div>
        
        <div class="detail-row">
          <span class="detail-label">آخر تحديث:</span>
          <span class="detail-value" id="withdrawModalUpdatedAt">-</span>
        </div>
        
        <div class="detail-row">
          <span class="detail-label">ملاحظات المسؤول:</span>
          <span class="detail-value" id="withdrawModalAdminNotes">لا توجد</span>
        </div>
        
        <div class="detail-row">
          <span class="detail-label">الحالة الحالية:</span>
          <span id="withdrawModalStatus" class="status-badge">-</span>
        </div>
        
        <!-- نموذج الإجراء (يظهر فقط للطلبات pending) -->
        <div id="withdrawActionForm" class="action-form">
          <div class="form-group">
            <label for="withdrawAdminNotesInput" class="form-label">
              <i class="fas fa-sticky-note"></i>
              ملاحظات المسؤول (اختياري)
            </label>
            <textarea id="withdrawAdminNotesInput" class="form-textarea" placeholder="أدخل ملاحظاتك هنا..."></textarea>
          </div>
          
          <div class="modal-actions">
            <button id="cancelWithdrawActionBtn" class="modal-btn cancel">
              <i class="fas fa-times"></i>
              إلغاء
            </button>
            <button id="rejectWithdrawRequestBtn" class="modal-btn reject">
              <i class="fas fa-times-circle"></i>
              رفض الطلب
            </button>
            <button id="approveWithdrawRequestBtn" class="modal-btn approve">
              <i class="fas fa-check-circle"></i>
              تأكيد الطلب
            </button>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- شاشة التحميل -->
  <div id="loading" class="loading">
    <div class="loading-spinner"></div>
    <div class="loading-text">جاري التحميل...</div>
  </div>

  <!-- رسائل التوست -->
  <div id="toast" class="toast">
    <i class="fas fa-check-circle" id="toastIcon"></i>
    <span id="toastMessage">تمت العملية بنجاح</span>
  </div>

  <script>
    // ========== تهيئة Firebase ==========
    const firebaseConfig = {
      apiKey: "AIzaSyBX8v0qIVjG-Z46fVDeEUDKcPxa_FQF9Qc",
      authDomain: "bnak-belaiba.firebaseapp.com",
      projectId: "bnak-belaiba",
      storageBucket: "bnak-belaiba.firebasestorage.app",
      messagingSenderId: "286736432059",
      appId: "1:286736432059:web:ec1ed4292850f00008229e"
    };

    let db;
    let firebaseApp;
    let depositRequestsListener = null;
    let withdrawRequestsListener = null;
    let allWithdrawsListener = null;
    let allRejectedDepositsListener = null;
    let allPendingDepositsListener = null;
    let allApprovedDepositsListener = null;
    let allApprovedWithdrawsListener = null;
    let allPendingWithdrawsListener = null;
    let allRejectedWithdrawsListener = null;
    let currentRequestId = null;
    let currentRequestType = null;
    let currentAllWithdrawsFilter = 'all';
    let currentAllRejectedDepositsFilter = 'rejected';
    let currentAllPendingDepositsFilter = 'pending';
    let currentAllApprovedDepositsFilter = 'approved';
    let currentAllApprovedWithdrawsFilter = 'approved';
    let currentAllPendingWithdrawsFilter = 'pending';
    let currentAllRejectedWithdrawsFilter = 'rejected';
    let currentAllWithdrawsSearch = '';
    let currentAllRejectedDepositsSearch = '';
    let currentAllPendingDepositsSearch = '';
    let currentAllApprovedDepositsSearch = '';
    let currentAllApprovedWithdrawsSearch = '';
    let currentAllPendingWithdrawsSearch = '';
    let currentAllRejectedWithdrawsSearch = '';

    // متغير جديد لمنع التكرار
    const processingRequests = new Set();

    try {
      firebaseApp = firebase.initializeApp(firebaseConfig);
      db = firebase.firestore(firebaseApp);
      console.log('✅ Firebase initialized successfully');
    } catch (error) {
      console.error('❌ Firebase initialization error:', error);
      showToast('❌ خطأ في الاتصال بقاعدة البيانات', 'error');
    }

    // ========== بيانات تسجيل الدخول ==========
    const ADMIN_CREDENTIALS = {
      username: 'admin',
      password: 'admin123'
    };

    // ========== دوال المساعدة ==========
    function showLoading() {
      document.getElementById('loading').style.display = 'flex';
    }

    function hideLoading() {
      document.getElementById('loading').style.display = 'none';
    }

    function showToast(message, type = 'success') {
      const toast = document.getElementById('toast');
      const toastIcon = document.getElementById('toastIcon');
      const toastMessage = document.getElementById('toastMessage');
      
      toast.className = `toast ${type}`;
      toastMessage.textContent = message;
      
      switch(type) {
        case 'success':
          toastIcon.className = 'fas fa-check-circle';
          break;
        case 'error':
          toastIcon.className = 'fas fa-exclamation-circle';
          break;
        case 'warning':
          toastIcon.className = 'fas fa-exclamation-triangle';
          break;
        case 'binance':
          toastIcon.className = 'fab fa-binance';
          break;
      }
      
      toast.style.display = 'flex';
      
      setTimeout(() => {
        toast.style.display = 'none';
      }, 3000);
    }

    function formatDate(date) {
      if (!date) return '-';
      
      const d = date.toDate ? date.toDate() : new Date(date);
      return d.toLocaleString('ar-EG', {
        year: 'numeric',
        month: 'long',
        day: 'numeric',
        hour: '2-digit',
        minute: '2-digit'
      });
    }

    // تنسيق الأرقام بالفرنسية (استخدام فواصل للآلاف ونقطة للكسور)
    function formatNumberFrench(number) {
      if (isNaN(number)) return '0';
      return parseFloat(number).toLocaleString('fr-FR', {
        minimumFractionDigits: 2,
        maximumFractionDigits: 2
      });
    }

    function formatCurrency(amount, currency) {
      return `${formatNumberFrench(amount)} ${currency}`;
    }

    function getTransferTypeText(type) {
      switch(type) {
        case 'bank': return 'تحويل بنكي (BaridiMob)';
        case 'binance': return 'تحويل بينانس';
        case 'other': return 'طريقة أخرى';
        default: return type;
      }
    }

    function getStatusText(status) {
      switch(status) {
        case 'pending': return 'قيد الانتظار';
        case 'approved': return 'مؤكد';
        case 'rejected': return 'مرفوض';
        default: return status;
      }
    }

    function getStatusClass(status) {
      switch(status) {
        case 'pending': return 'status-pending';
        case 'approved': return 'status-approved';
        case 'rejected': return 'status-rejected';
        default: return '';
      }
    }

    function getTransferTypeIcon(type) {
      switch(type) {
        case 'bank': return 'fas fa-university';
        case 'binance': return 'fas fa-coins';
        case 'other': return 'fas fa-exchange-alt';
        default: return 'fas fa-money-bill-wave';
      }
    }

    // ========== دالة تعطيل أزرار الإجراء ==========
    function disableActionButtons() {
      const buttons = [
        'approveDepositRequestBtn',
        'rejectDepositRequestBtn',
        'cancelDepositActionBtn',
        'approveWithdrawRequestBtn',
        'rejectWithdrawRequestBtn',
        'cancelWithdrawActionBtn'
      ];
      
      buttons.forEach(buttonId => {
        const button = document.getElementById(buttonId);
        if (button) {
          button.disabled = true;
          button.style.opacity = '0.5';
          button.style.cursor = 'not-allowed';
        }
      });
    }

    // ========== دالة تمكين أزرار الإجراء ==========
    function enableActionButtons() {
      const buttons = [
        'approveDepositRequestBtn',
        'rejectDepositRequestBtn',
        'cancelDepositActionBtn',
        'approveWithdrawRequestBtn',
        'rejectWithdrawRequestBtn',
        'cancelWithdrawActionBtn'
      ];
      
      buttons.forEach(buttonId => {
        const button = document.getElementById(buttonId);
        if (button) {
          button.disabled = false;
          button.style.opacity = '1';
          button.style.cursor = 'pointer';
        }
      });
    }

    // ========== دالة حساب إجمالي أرصدة المستخدمين ==========
    async function calculateTotalBalance() {
      try {
        showLoading();
        
        const usersSnapshot = await db.collection('users').get();
        let totalBalanceDZD = 0;
        let totalBalanceUSDT = 0;
        let userCount = 0;
        
        usersSnapshot.forEach((doc) => {
          const userData = doc.data();
          userCount++;
          
          // إذا كانت الأرصدة في كائن balances (مختلفة العملات)
          if (userData.balances && typeof userData.balances === 'object') {
            Object.keys(userData.balances).forEach(currency => {
              const balance = parseFloat(userData.balances[currency]) || 0;
              
              if (currency === 'USDT') {
                totalBalanceUSDT += balance;
              } else if (currency === 'DZD') {
                totalBalanceDZD += balance;
              }
            });
          }
        });
        
        // تحديث العرض بالأرقام الفرنسية
        document.getElementById('totalBalanceDZD').textContent = 
          formatNumberFrench(totalBalanceDZD) + ' DZD';
        
        document.getElementById('totalBalanceUSDT').textContent = 
          formatNumberFrench(totalBalanceUSDT) + ' USDT';
        
        hideLoading();
        return { totalBalanceDZD, totalBalanceUSDT, userCount };
        
      } catch (error) {
        console.error('❌ خطأ في حساب إجمالي الأرصدة:', error);
        showToast('❌ خطأ في حساب الإجمالي', 'error');
        hideLoading();
        return null;
      }
    }

    // ========== دوال Firebase ==========
    async function updateDepositStatus(requestId, status, adminNotes = '') {
      try {
        showLoading();
        
        const requestRef = db.collection('deposit_requests').doc(requestId);
        
        const updateData = {
          status: status,
          updatedAt: firebase.firestore.FieldValue.serverTimestamp(),
          processedAt: firebase.firestore.FieldValue.serverTimestamp()
        };
        
        if (adminNotes) {
          updateData.adminNotes = adminNotes;
        }
        
        if (status === 'approved') {
          const requestDoc = await requestRef.get();
          if (!requestDoc.exists) {
            throw new Error('طلب الإيداع غير موجود');
          }
          
          const requestData = requestDoc.data();
          
          // تحديث رصيد المستخدم
          const userRef = db.collection('users').doc(requestData.userId.toString());
          const userDoc = await userRef.get();
          
          if (userDoc.exists) {
            const userData = userDoc.data();
            const currentBalance = userData.balances?.[requestData.currency] || 0;
            const newBalance = currentBalance + requestData.amount;
            
            await userRef.update({
              [`balances.${requestData.currency}`]: newBalance
            });
            
            // إنشاء معاملة إيداع
            const transactionRef = db.collection('transactions').doc();
            await transactionRef.set({
              id: transactionRef.id,
              userId: requestData.userId,
              type: 'deposit',
              amount: requestData.amount,
              currency: requestData.currency,
              status: 'completed',
              description: `إيداع ${getTransferTypeText(requestData.transferType)}`,
              referenceId: requestData.transactionNumber,
              depositRequestId: requestId,
              timestamp: firebase.firestore.FieldValue.serverTimestamp()
            });
            
            // تحديث إجمالي الأرصدة بعد تحديث رصيد المستخدم
            calculateTotalBalance();
          }
        }
        
        await requestRef.update(updateData);
        
        showToast(`✅ تم ${status === 'approved' ? 'تأكيد' : 'رفض'} الطلب بنجاح`, 'success');
        closeDepositModal();
        
        return true;
      } catch (error) {
        console.error(`❌ خطأ في تحديث حالة الطلب:`, error);
        showToast(`❌ خطأ في ${status === 'approved' ? 'تأكيد' : 'رفض'} الطلب: ${error.message}`, 'error');
        return false;
      } finally {
        hideLoading();
      }
    }

    // ========== دالة تحديث حالة طلب السحب ==========
    async function updateWithdrawStatus(requestId, status, adminNotes = '') {
      try {
        // التحقق مما إذا كان الطلب قيد المعالجة حالياً
        if (processingRequests.has(requestId)) {
          showToast('⚠️ الطلب قيد المعالجة حالياً، الرجاء الانتظار', 'warning');
          return false;
        }
        
        showLoading();
        
        // إضافة الطلب إلى قائمة المعالجة
        processingRequests.add(requestId);
        
        // تعطيل أزرار الإجراء في النافذة
        disableActionButtons();
        
        const requestRef = db.collection('withdraw_requests').doc(requestId);
        const requestDoc = await requestRef.get();
        
        if (!requestDoc.exists) {
          throw new Error('طلب السحب غير موجود');
        }
        
        const requestData = requestDoc.data();
        
        // التحقق من أن الطلب لا يزال في حالة pending
        if (requestData.status !== 'pending') {
          throw new Error('تم معالجة هذا الطلب مسبقاً');
        }
        
        if (status === 'approved') {
          // عند تأكيد السحب
          const updateData = {
            status: 'approved',
            adminNotes: adminNotes || '',
            approvedAt: firebase.firestore.FieldValue.serverTimestamp(),
            updatedAt: firebase.firestore.FieldValue.serverTimestamp(),
            processedAt: firebase.firestore.FieldValue.serverTimestamp()
          };
          
          await requestRef.update(updateData);
          
          showToast(`✅ تم تأكيد طلب السحب بنجاح`, 'binance');
          
        } else if (status === 'rejected') {
          // عند رفض طلب السحب - نعيد المبلغ للمستخدم
          const userRef = db.collection('users').doc(requestData.userId.toString());
          const userDoc = await userRef.get();
          
          if (!userDoc.exists) {
            throw new Error('بيانات المستخدم غير موجودة');
          }
          
          const userData = userDoc.data();
          
          // التأكد من وجود رصيد USDT
          if (!userData.balances || typeof userData.balances['USDT'] === 'undefined') {
            throw new Error('رصيد المستخدم غير موجود');
          }
          
          // حساب المبلغ المراد إعادته (المبلغ + الرسوم)
          const refundAmount = parseFloat(requestData.amount) + parseFloat(requestData.fees || 0);
          const currentBalance = parseFloat(userData.balances['USDT']);
          const newBalance = currentBalance + refundAmount;
          
          // استخدام معاملة لضمان تكامل البيانات
          await db.runTransaction(async (transaction) => {
            // جلب بيانات الطلب مرة أخرى للتأكد من الحالة
            const freshRequestDoc = await transaction.get(requestRef);
            const freshRequestData = freshRequestDoc.data();
            
            if (freshRequestData.status !== 'pending') {
              throw new Error('تم تغيير حالة الطلب أثناء المعالجة');
            }
            
            // جلب بيانات المستخدم الحالية
            const freshUserDoc = await transaction.get(userRef);
            const freshUserData = freshUserDoc.data();
            
            if (!freshUserData.balances || typeof freshUserData.balances['USDT'] === 'undefined') {
              throw new Error('رصيد المستخدم غير موجود');
            }
            
            const freshCurrentBalance = parseFloat(freshUserData.balances['USDT']);
            const freshNewBalance = freshCurrentBalance + refundAmount;
            
            // تحديث رصيد المستخدم
            transaction.update(userRef, {
              'balances.USDT': freshNewBalance,
              lastUpdated: firebase.firestore.FieldValue.serverTimestamp()
            });
            
            // تحديث حالة طلب السحب مع وضع علامة الاسترجاع
            transaction.update(requestRef, {
              status: 'rejected',
              adminNotes: adminNotes || '',
              refundAmount: refundAmount,
              refundedAt: firebase.firestore.FieldValue.serverTimestamp(),
              updatedAt: firebase.firestore.FieldValue.serverTimestamp(),
              processedAt: firebase.firestore.FieldValue.serverTimestamp()
            });
          });
          
          // تحديث إجمالي الأرصدة
          calculateTotalBalance();
          
          showToast(`✅ تم رفض طلب السحب وإعادة المبلغ إلى رصيد المستخدم`, 'binance');
        }
        
        // إرسال إشعار للمستخدم
        sendWithdrawNotification(requestId, status, adminNotes);
        
        closeWithdrawModal();
        
        return true;
        
      } catch (error) {
        console.error(`❌ خطأ في تحديث حالة طلب السحب:`, error);
        
        if (error.message.includes('تم معالجة هذا الطلب مسبقاً')) {
          showToast(`⚠️ ${error.message}`, 'warning');
        } else {
          showToast(`❌ خطأ في ${status === 'approved' ? 'تأكيد' : 'رفض'} طلب السحب`, 'error');
        }
        
        return false;
        
      } finally {
        // إزالة الطلب من قائمة المعالجة
        processingRequests.delete(requestId);
        
        // إعادة تمكين الأزرار
        enableActionButtons();
        
        hideLoading();
      }
    }

    async function sendWithdrawNotification(requestId, status, adminNotes = '') {
      try {
        if (!db) return;
        
        const requestRef = db.collection('withdraw_requests').doc(requestId);
        const requestDoc = await requestRef.get();
        
        if (!requestDoc.exists) return;
        
        const requestData = requestDoc.data();
        
        const notificationRef = db.collection('notifications').doc();
        await notificationRef.set({
          userId: requestData.userId,
          type: 'withdraw_status_update',
          title: `تحديث حالة طلب السحب ${requestData.requestId}`,
          message: status === 'approved' 
            ? `تم تأكيد طلب السحب الخاص بك بمبلغ ${formatCurrency(requestData.netAmount, requestData.currency)}`
            : `تم رفض طلب السحب الخاص بمبلغ ${formatCurrency(requestData.amount, requestData.currency)} وتم إعادة الرصيد إلى حسابك`,
          data: {
            requestId: requestId,
            status: status,
            amount: requestData.amount,
            netAmount: requestData.netAmount,
            currency: requestData.currency,
            adminNotes: adminNotes,
            timestamp: new Date().toISOString()
          },
          read: false,
          createdAt: firebase.firestore.FieldValue.serverTimestamp()
        });
        
        console.log('📨 تم إرسال إشعار تحديث حالة السحب للمستخدم');
        
      } catch (error) {
        console.error('❌ خطأ في إرسال إشعار السحب:', error);
      }
    }

    async function getUserData(userId) {
      try {
        const userRef = db.collection('users').doc(userId.toString());
        const userDoc = await userRef.get();
        
        if (userDoc.exists) {
          return userDoc.data();
        }
        return null;
      } catch (error) {
        console.error('❌ خطأ في جلب بيانات المستخدم:', error);
        return null;
      }
    }

    // ========== دوال عرض البيانات ==========
    function setupRealtimeDepositListener() {
      if (depositRequestsListener) {
        depositRequestsListener();
      }
      
      depositRequestsListener = db.collection('deposit_requests')
        .orderBy('createdAt', 'desc')
        .onSnapshot((snapshot) => {
          const requests = [];
          const stats = {
            pending: 0,
            approved: 0,
            rejected: 0,
            total: 0
          };
          
          snapshot.forEach((doc) => {
            const request = {
              id: doc.id,
              ...doc.data()
            };
            requests.push(request);
            
            stats.total++;
            if (request.status === 'pending') stats.pending++;
            if (request.status === 'approved') stats.approved++;
            if (request.status === 'rejected') stats.rejected++;
          });
          
          updateDepositStats(stats);
        }, (error) => {
          console.error('❌ خطأ في الاستماع لتحديثات الطلبات:', error);
          showToast('❌ خطأ في تحديث الطلبات', 'error');
        });
    }

    function setupRealtimeWithdrawListener() {
      if (withdrawRequestsListener) {
        withdrawRequestsListener();
      }
      
      withdrawRequestsListener = db.collection('withdraw_requests')
        .orderBy('createdAt', 'desc')
        .onSnapshot((snapshot) => {
          const requests = [];
          const stats = {
            total: 0,
            pending: 0,
            approved: 0,
            rejected: 0
          };
          
          snapshot.forEach((doc) => {
            const request = {
              id: doc.id,
              ...doc.data()
            };
            requests.push(request);
            
            stats.total++;
            if (request.status === 'pending') stats.pending++;
            if (request.status === 'approved') stats.approved++;
            if (request.status === 'rejected') stats.rejected++;
          });
          
          updateWithdrawStats(stats);
        }, (error) => {
          console.error('❌ خطأ في الاستماع لتحديثات طلبات السحب:', error);
          showToast('❌ خطأ في تحديث طلبات السحب', 'error');
        });
    }

    function setupAllWithdrawsListener() {
      if (allWithdrawsListener) {
        allWithdrawsListener();
      }
      
      allWithdrawsListener = db.collection('withdraw_requests')
        .orderBy('createdAt', 'desc')
        .onSnapshot((snapshot) => {
          const requests = [];
          const stats = {
            total: 0,
            pending: 0,
            approved: 0,
            rejected: 0
          };
          
          snapshot.forEach((doc) => {
            const request = {
              id: doc.id,
              ...doc.data()
            };
            requests.push(request);
            
            stats.total++;
            if (request.status === 'pending') stats.pending++;
            if (request.status === 'approved') stats.approved++;
            if (request.status === 'rejected') stats.rejected++;
          });
          
          updateWithdrawStats(stats);
          renderAllWithdrawsList(requests);
        }, (error) => {
          console.error('❌ خطأ في الاستماع لتحديثات جميع طلبات السحب:', error);
          showToast('❌ خطأ في تحديث جميع طلبات السحب', 'error');
        });
    }

    function setupAllRejectedDepositsListener() {
      if (allRejectedDepositsListener) {
        allRejectedDepositsListener();
      }
      
      allRejectedDepositsListener = db.collection('deposit_requests')
        .where('status', '==', 'rejected')
        .orderBy('createdAt', 'desc')
        .onSnapshot((snapshot) => {
          const requests = [];
          
          snapshot.forEach((doc) => {
            const request = {
              id: doc.id,
              ...doc.data()
            };
            requests.push(request);
          });
          
          renderAllRejectedDepositsList(requests);
        }, (error) => {
          console.error('❌ خطأ في الاستماع لتحديثات جميع طلبات الإيداع المرفوضة:', error);
          showToast('❌ خطأ في تحديث جميع الطلبات المرفوضة', 'error');
        });
    }

    function setupAllPendingDepositsListener() {
      if (allPendingDepositsListener) {
        allPendingDepositsListener();
      }
      
      allPendingDepositsListener = db.collection('deposit_requests')
        .where('status', '==', 'pending')
        .orderBy('createdAt', 'desc')
        .onSnapshot((snapshot) => {
          const requests = [];
          
          snapshot.forEach((doc) => {
            const request = {
              id: doc.id,
              ...doc.data()
            };
            requests.push(request);
          });
          
          renderAllPendingDepositsList(requests);
        }, (error) => {
          console.error('❌ خطأ في الاستماع لتحديثات جميع طلبات الإيداع قيد الانتظار:', error);
          showToast('❌ خطأ في تحديث جميع الطلبات قيد الانتظار', 'error');
        });
    }

    function setupAllApprovedDepositsListener() {
      if (allApprovedDepositsListener) {
        allApprovedDepositsListener();
      }
      
      allApprovedDepositsListener = db.collection('deposit_requests')
        .where('status', '==', 'approved')
        .orderBy('createdAt', 'desc')
        .onSnapshot((snapshot) => {
          const requests = [];
          
          snapshot.forEach((doc) => {
            const request = {
              id: doc.id,
              ...doc.data()
            };
            requests.push(request);
          });
          
          renderAllApprovedDepositsList(requests);
        }, (error) => {
          console.error('❌ خطأ في الاستماع لتحديثات جميع طلبات الإيداع المؤكدة:', error);
          showToast('❌ خطأ في تحديث جميع الطلبات المؤكدة', 'error');
        });
    }

    function setupAllApprovedWithdrawsListener() {
      if (allApprovedWithdrawsListener) {
        allApprovedWithdrawsListener();
      }
      
      allApprovedWithdrawsListener = db.collection('withdraw_requests')
        .where('status', '==', 'approved')
        .orderBy('createdAt', 'desc')
        .onSnapshot((snapshot) => {
          const requests = [];
          
          snapshot.forEach((doc) => {
            const request = {
              id: doc.id,
              ...doc.data()
            };
            requests.push(request);
          });
          
          renderAllApprovedWithdrawsList(requests);
        }, (error) => {
          console.error('❌ خطأ في الاستماع لتحديثات جميع طلبات السحب المؤكدة:', error);
          showToast('❌ خطأ في تحديث جميع طلبات السحب المؤكدة', 'error');
        });
    }

    function setupAllPendingWithdrawsListener() {
      if (allPendingWithdrawsListener) {
        allPendingWithdrawsListener();
      }
      
      allPendingWithdrawsListener = db.collection('withdraw_requests')
        .where('status', '==', 'pending')
        .orderBy('createdAt', 'desc')
        .onSnapshot((snapshot) => {
          const requests = [];
          
          snapshot.forEach((doc) => {
            const request = {
              id: doc.id,
              ...doc.data()
            };
            requests.push(request);
          });
          
          renderAllPendingWithdrawsList(requests);
        }, (error) => {
          console.error('❌ خطأ في الاستماع لتحديثات جميع طلبات السحب قيد الانتظار:', error);
          showToast('❌ خطأ في تحديث جميع طلبات السحب قيد الانتظار', 'error');
        });
    }

    function setupAllRejectedWithdrawsListener() {
      if (allRejectedWithdrawsListener) {
        allRejectedWithdrawsListener();
      }
      
      allRejectedWithdrawsListener = db.collection('withdraw_requests')
        .where('status', '==', 'rejected')
        .orderBy('createdAt', 'desc')
        .onSnapshot((snapshot) => {
          const requests = [];
          
          snapshot.forEach((doc) => {
            const request = {
              id: doc.id,
              ...doc.data()
            };
            requests.push(request);
          });
          
          renderAllRejectedWithdrawsList(requests);
        }, (error) => {
          console.error('❌ خطأ في الاستماع لتحديثات جميع طلبات السحب المرفوضة:', error);
          showToast('❌ خطأ في تحديث جميع طلبات السحب المرفوضة', 'error');
        });
    }

    function updateDepositStats(stats) {
      // عرض الأرقام بالفرنسية
      document.getElementById('pendingDepositCount').textContent = formatNumberFrench(stats.pending);
      document.getElementById('approvedDepositCount').textContent = formatNumberFrench(stats.approved);
      document.getElementById('rejectedDepositCount').textContent = formatNumberFrench(stats.rejected);
    }

    function updateWithdrawStats(stats) {
      // عرض الأرقام بالفرنسية
      document.getElementById('approvedWithdrawCount').textContent = formatNumberFrench(stats.approved);
      document.getElementById('pendingWithdrawCount').textContent = formatNumberFrench(stats.pending);
      document.getElementById('rejectedWithdrawCount').textContent = formatNumberFrench(stats.rejected);
    }

    function renderAllWithdrawsList(requests) {
      const requestsList = document.getElementById('allWithdrawsList');
      requestsList.innerHTML = '';
      
      let filteredRequests = requests;
      
      // تطبيق الفلتر
      if (currentAllWithdrawsFilter !== 'all') {
        filteredRequests = filteredRequests.filter(request => request.status === currentAllWithdrawsFilter);
      }
      
      // تطبيق البحث
      if (currentAllWithdrawsSearch.trim() !== '') {
        const searchTerm = currentAllWithdrawsSearch.toLowerCase();
        filteredRequests = filteredRequests.filter(request => 
          request.id.toLowerCase().includes(searchTerm) ||
          (request.userName && request.userName.toLowerCase().includes(searchTerm)) ||
          (request.binanceId && request.binanceId.toLowerCase().includes(searchTerm)) ||
          (request.requestId && request.requestId.toLowerCase().includes(searchTerm))
        );
      }
      
      if (filteredRequests.length === 0) {
        requestsList.innerHTML = `
          <div class="no-requests">
            <div class="no-requests-icon">
              <i class="fab fa-binance"></i>
            </div>
            <div class="no-requests-title">لا توجد طلبات سحب</div>
            <div class="no-requests-text">
              ${currentAllWithdrawsSearch ? 'لم يتم العثور على طلبات تطابق بحثك' : 'لا توجد طلبات سحب لعرضها'}
            </div>
          </div>
        `;
        return;
      }
      
      filteredRequests.forEach(request => {
        const requestCard = document.createElement('div');
        requestCard.className = `request-card ${request.status}`;
        
        const date = request.createdAt ? formatDate(request.createdAt) : '-';
        const amountText = formatCurrency(request.amount, request.currency);
        const feesText = formatCurrency(request.fees, request.currency);
        const netAmountText = formatCurrency(request.netAmount, request.currency);
        const statusText = getStatusText(request.status);
        const statusClass = getStatusClass(request.status);
        const userInitial = request.userName ? request.userName.charAt(0) : 'م';
        
        requestCard.innerHTML = `
          <div class="request-header">
            <div class="request-id">
              <i class="fab fa-binance"></i>
              ${request.requestId || request.id.substring(0, 8)}...
            </div>
            <div class="request-status ${statusClass}">
              ${statusText}
            </div>
          </div>
          
          <div class="request-content">
            <!-- معلومات المستخدم -->
            <div class="request-info">
              <div class="info-label">
                <i class="fas fa-user"></i>
                المستخدم
              </div>
              <div class="info-value info-user">
                <div class="user-avatar binance">${userInitial}</div>
                <div class="user-info">
                  <div class="user-name">${request.userName || 'مستخدم'}</div>
                  <div class="user-id">ID: ${request.userId}</div>
                </div>
              </div>
            </div>
            
            <!-- المبلغ -->
            <div class="request-info">
              <div class="info-label">
                <i class="fas fa-money-bill-wave"></i>
                المبلغ
              </div>
              <div class="info-value info-amount">${amountText}</div>
            </div>
            
            <!-- الرسوم -->
            <div class="request-info">
              <div class="info-label">
                <i class="fas fa-percentage"></i>
                الرسوم
              </div>
              <div class="info-value">${feesText}</div>
            </div>
            
            <!-- المبلغ الصافي -->
            <div class="request-info">
              <div class="info-label">
                <i class="fas fa-coins"></i>
                المبلغ الصافي
              </div>
              <div class="info-value">${netAmountText}</div>
            </div>
            
            <!-- معرف Binance -->
            <div class="request-info">
              <div class="info-label">
                <i class="fab fa-binance"></i>
                معرف Binance
              </div>
              <div class="info-value" style="font-family: 'Courier New', monospace; font-size: 11px;">
                ${request.binanceId}
              </div>
            </div>
            
            <!-- التاريخ -->
            <div class="request-info">
              <div class="info-label">
                <i class="fas fa-calendar"></i>
                تاريخ الطلب
              </div>
              <div class="info-value">${date}</div>
            </div>
            
            <!-- ملاحظات المسؤول -->
            <div class="request-info">
              <div class="info-label">
                <i class="fas fa-sticky-note"></i>
                ملاحظات المسؤول
              </div>
              <div class="info-value">
                ${request.adminNotes ? request.adminNotes.substring(0, 40) + (request.adminNotes.length > 40 ? '...' : '') : 'لا توجد'}
              </div>
            </div>
          </div>
          
          <div class="request-actions">
            <button class="action-btn view binance" data-id="${request.id}" data-type="withdraw">
              <i class="fas fa-eye"></i>
              عرض التفاصيل
            </button>
            
            ${request.status === 'pending' ? `
              <button class="action-btn approve" data-id="${request.id}" data-type="withdraw">
                <i class="fas fa-check"></i>
                تأكيد
              </button>
              
              <button class="action-btn reject" data-id="${request.id}" data-type="withdraw">
                <i class="fas fa-times"></i>
                رفض
              </button>
            ` : ''}
          </div>
        `;
        
        requestsList.appendChild(requestCard);
      });
      
      // إضافة الأحداث للأزرار
      document.querySelectorAll('#allWithdrawsList .action-btn.view[data-type="withdraw"]').forEach(btn => {
        btn.addEventListener('click', function() {
          const requestId = this.getAttribute('data-id');
          const type = this.getAttribute('data-type');
          showWithdrawRequestDetails(requestId, type);
        });
      });
      
      document.querySelectorAll('#allWithdrawsList .action-btn.approve[data-type="withdraw"]').forEach(btn => {
        btn.addEventListener('click', function() {
          const requestId = this.getAttribute('data-id');
          const type = this.getAttribute('data-type');
          showWithdrawRequestDetails(requestId, type, 'approve');
        });
      });
      
      document.querySelectorAll('#allWithdrawsList .action-btn.reject[data-type="withdraw"]').forEach(btn => {
        btn.addEventListener('click', function() {
          const requestId = this.getAttribute('data-id');
          const type = this.getAttribute('data-type');
          showWithdrawRequestDetails(requestId, type, 'reject');
        });
      });
    }

    function renderAllRejectedDepositsList(requests) {
      const requestsList = document.getElementById('allRejectedDepositsList');
      requestsList.innerHTML = '';
      
      let filteredRequests = requests;
      
      // تطبيق البحث
      if (currentAllRejectedDepositsSearch.trim() !== '') {
        const searchTerm = currentAllRejectedDepositsSearch.toLowerCase();
        filteredRequests = filteredRequests.filter(request => 
          request.id.toLowerCase().includes(searchTerm) ||
          (request.userName && request.userName.toLowerCase().includes(searchTerm)) ||
          (request.transactionNumber && request.transactionNumber.toLowerCase().includes(searchTerm))
        );
      }
      
      if (filteredRequests.length === 0) {
        requestsList.innerHTML = `
          <div class="no-requests">
            <div class="no-requests-icon" style="color: var(--danger);">
              <i class="fas fa-times-circle"></i>
            </div>
            <div class="no-requests-title">لا توجد طلبات مرفوضة</div>
            <div class="no-requests-text">
              ${currentAllRejectedDepositsSearch ? 'لم يتم العثور على طلبات تطابق بحثك' : 'لا توجد طلبات إيداع مرفوضة لعرضها'}
            </div>
          </div>
        `;
        return;
      }
      
      filteredRequests.forEach(request => {
        const requestCard = document.createElement('div');
        requestCard.className = `request-card ${request.status}`;
        
        const date = request.createdAt ? formatDate(request.createdAt) : '-';
        const amountText = formatCurrency(request.amount, request.currency);
        const transferTypeText = getTransferTypeText(request.transferType);
        const transferTypeIcon = getTransferTypeIcon(request.transferType);
        const statusText = getStatusText(request.status);
        const statusClass = getStatusClass(request.status);
        const userInitial = request.userName ? request.userName.charAt(0) : 'م';
        
        requestCard.innerHTML = `
          <div class="request-header">
            <div class="request-id">
              <i class="fas fa-hashtag"></i>
              ${request.id.substring(0, 8)}...
            </div>
            <div class="request-status ${statusClass}">
              ${statusText}
            </div>
          </div>
          
          <div class="request-content">
            <!-- معلومات المستخدم -->
            <div class="request-info">
              <div class="info-label">
                <i class="fas fa-user"></i>
                المستخدم
              </div>
              <div class="info-value info-user">
                <div class="user-avatar">${userInitial}</div>
                <div class="user-info">
                  <div class="user-name">${request.userName || 'مستخدم'}</div>
                  <div class="user-id">ID: ${request.userId}</div>
                </div>
              </div>
            </div>
            
            <!-- المبلغ -->
            <div class="request-info">
              <div class="info-label">
                <i class="fas fa-money-bill-wave"></i>
                المبلغ
              </div>
              <div class="info-value info-amount">${amountText}</div>
            </div>
            
            <!-- نوع التحويل -->
            <div class="request-info">
              <div class="info-label">
                <i class="${transferTypeIcon}"></i>
                نوع التحويل
              </div>
              <div class="info-value">${transferTypeText}</div>
            </div>
            
            <!-- رقم العملية -->
            <div class="request-info">
              <div class="info-label">
                <i class="fas fa-receipt"></i>
                رقم العملية
              </div>
              <div class="info-value" style="font-family: 'Courier New', monospace; font-size: 11px;">
                ${request.transactionNumber}
              </div>
            </div>
            
            <!-- التاريخ -->
            <div class="request-info">
              <div class="info-label">
                <i class="fas fa-calendar"></i>
                تاريخ الطلب
              </div>
              <div class="info-value">${date}</div>
            </div>
            
            <!-- ملاحظات المسؤول -->
            <div class="request-info">
              <div class="info-label">
                <i class="fas fa-sticky-note"></i>
                ملاحظات المسؤول
              </div>
              <div class="info-value">
                ${request.adminNotes ? request.adminNotes.substring(0, 40) + (request.adminNotes.length > 40 ? '...' : '') : 'لا توجد'}
              </div>
            </div>
          </div>
          
          <div class="request-actions">
            <button class="action-btn view" data-id="${request.id}" data-type="deposit">
              <i class="fas fa-eye"></i>
              عرض التفاصيل
            </button>
          </div>
        `;
        
        requestsList.appendChild(requestCard);
      });
      
      // إضافة الأحداث للأزرار
      document.querySelectorAll('#allRejectedDepositsList .action-btn.view[data-type="deposit"]').forEach(btn => {
        btn.addEventListener('click', function() {
          const requestId = this.getAttribute('data-id');
          const type = this.getAttribute('data-type');
          showDepositRequestDetails(requestId, type);
        });
      });
    }

    function renderAllPendingDepositsList(requests) {
      const requestsList = document.getElementById('allPendingDepositsList');
      requestsList.innerHTML = '';
      
      let filteredRequests = requests;
      
      // تطبيق البحث
      if (currentAllPendingDepositsSearch.trim() !== '') {
        const searchTerm = currentAllPendingDepositsSearch.toLowerCase();
        filteredRequests = filteredRequests.filter(request => 
          request.id.toLowerCase().includes(searchTerm) ||
          (request.userName && request.userName.toLowerCase().includes(searchTerm)) ||
          (request.transactionNumber && request.transactionNumber.toLowerCase().includes(searchTerm))
        );
      }
      
      if (filteredRequests.length === 0) {
        requestsList.innerHTML = `
          <div class="no-requests">
            <div class="no-requests-icon" style="color: var(--warning);">
              <i class="fas fa-clock"></i>
            </div>
            <div class="no-requests-title">لا توجد طلبات قيد الانتظار</div>
            <div class="no-requests-text">
              ${currentAllPendingDepositsSearch ? 'لم يتم العثور على طلبات تطابق بحثك' : 'لا توجد طلبات إيداع قيد الانتظار لعرضها'}
            </div>
          </div>
        `;
        return;
      }
      
      filteredRequests.forEach(request => {
        const requestCard = document.createElement('div');
        requestCard.className = `request-card ${request.status}`;
        
        const date = request.createdAt ? formatDate(request.createdAt) : '-';
        const amountText = formatCurrency(request.amount, request.currency);
        const transferTypeText = getTransferTypeText(request.transferType);
        const transferTypeIcon = getTransferTypeIcon(request.transferType);
        const statusText = getStatusText(request.status);
        const statusClass = getStatusClass(request.status);
        const userInitial = request.userName ? request.userName.charAt(0) : 'م';
        
        requestCard.innerHTML = `
          <div class="request-header">
            <div class="request-id">
              <i class="fas fa-hashtag"></i>
              ${request.id.substring(0, 8)}...
            </div>
            <div class="request-status ${statusClass}">
              ${statusText}
            </div>
          </div>
          
          <div class="request-content">
            <!-- معلومات المستخدم -->
            <div class="request-info">
              <div class="info-label">
                <i class="fas fa-user"></i>
                المستخدم
              </div>
              <div class="info-value info-user">
                <div class="user-avatar">${userInitial}</div>
                <div class="user-info">
                  <div class="user-name">${request.userName || 'مستخدم'}</div>
                  <div class="user-id">ID: ${request.userId}</div>
                </div>
              </div>
            </div>
            
            <!-- المبلغ -->
            <div class="request-info">
              <div class="info-label">
                <i class="fas fa-money-bill-wave"></i>
                المبلغ
              </div>
              <div class="info-value info-amount">${amountText}</div>
            </div>
            
            <!-- نوع التحويل -->
            <div class="request-info">
              <div class="info-label">
                <i class="${transferTypeIcon}"></i>
                نوع التحويل
              </div>
              <div class="info-value">${transferTypeText}</div>
            </div>
            
            <!-- رقم العملية -->
            <div class="request-info">
              <div class="info-label">
                <i class="fas fa-receipt"></i>
                رقم العملية
              </div>
              <div class="info-value" style="font-family: 'Courier New', monospace; font-size: 11px;">
                ${request.transactionNumber}
              </div>
            </div>
            
            <!-- التاريخ -->
            <div class="request-info">
              <div class="info-label">
                <i class="fas fa-calendar"></i>
                تاريخ الطلب
              </div>
              <div class="info-value">${date}</div>
            </div>
            
            <!-- ملاحظات -->
            <div class="request-info">
              <div class="info-label">
                <i class="fas fa-sticky-note"></i>
                ملاحظات
              </div>
              <div class="info-value">
                ${request.notes ? request.notes.substring(0, 40) + (request.notes.length > 40 ? '...' : '') : 'لا توجد'}
              </div>
            </div>
          </div>
          
          <div class="request-actions">
            <button class="action-btn view" data-id="${request.id}" data-type="deposit">
              <i class="fas fa-eye"></i>
              عرض التفاصيل
            </button>
            
            <button class="action-btn approve" data-id="${request.id}" data-type="deposit">
              <i class="fas fa-check"></i>
              تأكيد
            </button>
            
            <button class="action-btn reject" data-id="${request.id}" data-type="deposit">
              <i class="fas fa-times"></i>
              رفض
            </button>
          </div>
        `;
        
        requestsList.appendChild(requestCard);
      });
      
      // إضافة الأحداث للأزرار
      document.querySelectorAll('#allPendingDepositsList .action-btn.view[data-type="deposit"]').forEach(btn => {
        btn.addEventListener('click', function() {
          const requestId = this.getAttribute('data-id');
          const type = this.getAttribute('data-type');
          showDepositRequestDetails(requestId, type);
        });
      });
      
      document.querySelectorAll('#allPendingDepositsList .action-btn.approve[data-type="deposit"]').forEach(btn => {
        btn.addEventListener('click', function() {
          const requestId = this.getAttribute('data-id');
          const type = this.getAttribute('data-type');
          showDepositRequestDetails(requestId, type, 'approve');
        });
      });
      
      document.querySelectorAll('#allPendingDepositsList .action-btn.reject[data-type="deposit"]').forEach(btn => {
        btn.addEventListener('click', function() {
          const requestId = this.getAttribute('data-id');
          const type = this.getAttribute('data-type');
          showDepositRequestDetails(requestId, type, 'reject');
        });
      });
    }

    function renderAllApprovedDepositsList(requests) {
      const requestsList = document.getElementById('allApprovedDepositsList');
      requestsList.innerHTML = '';
      
      let filteredRequests = requests;
      
      // تطبيق البحث
      if (currentAllApprovedDepositsSearch.trim() !== '') {
        const searchTerm = currentAllApprovedDepositsSearch.toLowerCase();
        filteredRequests = filteredRequests.filter(request => 
          request.id.toLowerCase().includes(searchTerm) ||
          (request.userName && request.userName.toLowerCase().includes(searchTerm)) ||
          (request.transactionNumber && request.transactionNumber.toLowerCase().includes(searchTerm))
        );
      }
      
      if (filteredRequests.length === 0) {
        requestsList.innerHTML = `
          <div class="no-requests">
            <div class="no-requests-icon" style="color: var(--success);">
              <i class="fas fa-check-circle"></i>
            </div>
            <div class="no-requests-title">لا توجد طلبات مؤكدة</div>
            <div class="no-requests-text">
              ${currentAllApprovedDepositsSearch ? 'لم يتم العثور على طلبات تطابق بحثك' : 'لا توجد طلبات إيداع مؤكدة لعرضها'}
            </div>
          </div>
        `;
        return;
      }
      
      filteredRequests.forEach(request => {
        const requestCard = document.createElement('div');
        requestCard.className = `request-card ${request.status}`;
        
        const date = request.createdAt ? formatDate(request.createdAt) : '-';
        const amountText = formatCurrency(request.amount, request.currency);
        const transferTypeText = getTransferTypeText(request.transferType);
        const transferTypeIcon = getTransferTypeIcon(request.transferType);
        const statusText = getStatusText(request.status);
        const statusClass = getStatusClass(request.status);
        const userInitial = request.userName ? request.userName.charAt(0) : 'م';
        
        requestCard.innerHTML = `
          <div class="request-header">
            <div class="request-id">
              <i class="fas fa-hashtag"></i>
              ${request.id.substring(0, 8)}...
            </div>
            <div class="request-status ${statusClass}">
              ${statusText}
            </div>
          </div>
          
          <div class="request-content">
            <!-- معلومات المستخدم -->
            <div class="request-info">
              <div class="info-label">
                <i class="fas fa-user"></i>
                المستخدم
              </div>
              <div class="info-value info-user">
                <div class="user-avatar">${userInitial}</div>
                <div class="user-info">
                  <div class="user-name">${request.userName || 'مستخدم'}</div>
                  <div class="user-id">ID: ${request.userId}</div>
                </div>
              </div>
            </div>
            
            <!-- المبلغ -->
            <div class="request-info">
              <div class="info-label">
                <i class="fas fa-money-bill-wave"></i>
                المبلغ
              </div>
              <div class="info-value info-amount">${amountText}</div>
            </div>
            
            <!-- نوع التحويل -->
            <div class="request-info">
              <div class="info-label">
                <i class="${transferTypeIcon}"></i>
                نوع التحويل
              </div>
              <div class="info-value">${transferTypeText}</div>
            </div>
            
            <!-- رقم العملية -->
            <div class="request-info">
              <div class="info-label">
                <i class="fas fa-receipt"></i>
                رقم العملية
              </div>
              <div class="info-value" style="font-family: 'Courier New', monospace; font-size: 11px;">
                ${request.transactionNumber}
              </div>
            </div>
            
            <!-- التاريخ -->
            <div class="request-info">
              <div class="info-label">
                <i class="fas fa-calendar"></i>
                تاريخ الطلب
              </div>
              <div class="info-value">${date}</div>
            </div>
            
            <!-- ملاحظات المسؤول -->
            <div class="request-info">
              <div class="info-label">
                <i class="fas fa-sticky-note"></i>
                ملاحظات المسؤول
              </div>
              <div class="info-value">
                ${request.adminNotes ? request.adminNotes.substring(0, 40) + (request.adminNotes.length > 40 ? '...' : '') : 'لا توجد'}
              </div>
            </div>
          </div>
          
          <div class="request-actions">
            <button class="action-btn view" data-id="${request.id}" data-type="deposit">
              <i class="fas fa-eye"></i>
              عرض التفاصيل
            </button>
          </div>
        `;
        
        requestsList.appendChild(requestCard);
      });
      
      // إضافة الأحداث للأزرار
      document.querySelectorAll('#allApprovedDepositsList .action-btn.view[data-type="deposit"]').forEach(btn => {
        btn.addEventListener('click', function() {
          const requestId = this.getAttribute('data-id');
          const type = this.getAttribute('data-type');
          showDepositRequestDetails(requestId, type);
        });
      });
    }

    function renderAllApprovedWithdrawsList(requests) {
      const requestsList = document.getElementById('allApprovedWithdrawsList');
      requestsList.innerHTML = '';
      
      let filteredRequests = requests;
      
      // تطبيق البحث
      if (currentAllApprovedWithdrawsSearch.trim() !== '') {
        const searchTerm = currentAllApprovedWithdrawsSearch.toLowerCase();
        filteredRequests = filteredRequests.filter(request => 
          request.id.toLowerCase().includes(searchTerm) ||
          (request.userName && request.userName.toLowerCase().includes(searchTerm)) ||
          (request.binanceId && request.binanceId.toLowerCase().includes(searchTerm)) ||
          (request.requestId && request.requestId.toLowerCase().includes(searchTerm))
        );
      }
      
      if (filteredRequests.length === 0) {
        requestsList.innerHTML = `
          <div class="no-requests">
            <div class="no-requests-icon" style="color: var(--success);">
              <i class="fab fa-binance"></i>
            </div>
            <div class="no-requests-title">لا توجد طلبات سحب مؤكدة</div>
            <div class="no-requests-text">
              ${currentAllApprovedWithdrawsSearch ? 'لم يتم العثور على طلبات تطابق بحثك' : 'لا توجد طلبات سحب مؤكدة لعرضها'}
            </div>
          </div>
        `;
        return;
      }
      
      filteredRequests.forEach(request => {
        const requestCard = document.createElement('div');
        requestCard.className = `request-card ${request.status}`;
        
        const date = request.createdAt ? formatDate(request.createdAt) : '-';
        const amountText = formatCurrency(request.amount, request.currency);
        const feesText = formatCurrency(request.fees, request.currency);
        const netAmountText = formatCurrency(request.netAmount, request.currency);
        const statusText = getStatusText(request.status);
        const statusClass = getStatusClass(request.status);
        const userInitial = request.userName ? request.userName.charAt(0) : 'م';
        
        requestCard.innerHTML = `
          <div class="request-header">
            <div class="request-id">
              <i class="fab fa-binance"></i>
              ${request.requestId || request.id.substring(0, 8)}...
            </div>
            <div class="request-status ${statusClass}">
              ${statusText}
            </div>
          </div>
          
          <div class="request-content">
            <!-- معلومات المستخدم -->
            <div class="request-info">
              <div class="info-label">
                <i class="fas fa-user"></i>
                المستخدم
              </div>
              <div class="info-value info-user">
                <div class="user-avatar binance">${userInitial}</div>
                <div class="user-info">
                  <div class="user-name">${request.userName || 'مستخدم'}</div>
                  <div class="user-id">ID: ${request.userId}</div>
                </div>
              </div>
            </div>
            
            <!-- المبلغ -->
            <div class="request-info">
              <div class="info-label">
                <i class="fas fa-money-bill-wave"></i>
                المبلغ
              </div>
              <div class="info-value info-amount">${amountText}</div>
            </div>
            
            <!-- الرسوم -->
            <div class="request-info">
              <div class="info-label">
                <i class="fas fa-percentage"></i>
                الرسوم
              </div>
              <div class="info-value">${feesText}</div>
            </div>
            
            <!-- المبلغ الصافي -->
            <div class="request-info">
              <div class="info-label">
                <i class="fas fa-coins"></i>
                المبلغ الصافي
              </div>
              <div class="info-value">${netAmountText}</div>
            </div>
            
            <!-- معرف Binance -->
            <div class="request-info">
              <div class="info-label">
                <i class="fab fa-binance"></i>
                معرف Binance
              </div>
              <div class="info-value" style="font-family: 'Courier New', monospace; font-size: 11px;">
                ${request.binanceId}
              </div>
            </div>
            
            <!-- التاريخ -->
            <div class="request-info">
              <div class="info-label">
                <i class="fas fa-calendar"></i>
                تاريخ الطلب
              </div>
              <div class="info-value">${date}</div>
            </div>
            
            <!-- ملاحظات المسؤول -->
            <div class="request-info">
              <div class="info-label">
                <i class="fas fa-sticky-note"></i>
                ملاحظات المسؤول
              </div>
              <div class="info-value">
                ${request.adminNotes ? request.adminNotes.substring(0, 40) + (request.adminNotes.length > 40 ? '...' : '') : 'لا توجد'}
              </div>
            </div>
          </div>
          
          <div class="request-actions">
            <button class="action-btn view binance" data-id="${request.id}" data-type="withdraw">
              <i class="fas fa-eye"></i>
              عرض التفاصيل
            </button>
          </div>
        `;
        
        requestsList.appendChild(requestCard);
      });
      
      // إضافة الأحداث للأزرار
      document.querySelectorAll('#allApprovedWithdrawsList .action-btn.view[data-type="withdraw"]').forEach(btn => {
        btn.addEventListener('click', function() {
          const requestId = this.getAttribute('data-id');
          const type = this.getAttribute('data-type');
          showWithdrawRequestDetails(requestId, type);
        });
      });
    }

    function renderAllPendingWithdrawsList(requests) {
      const requestsList = document.getElementById('allPendingWithdrawsList');
      requestsList.innerHTML = '';
      
      let filteredRequests = requests;
      
      // تطبيق البحث
      if (currentAllPendingWithdrawsSearch.trim() !== '') {
        const searchTerm = currentAllPendingWithdrawsSearch.toLowerCase();
        filteredRequests = filteredRequests.filter(request => 
          request.id.toLowerCase().includes(searchTerm) ||
          (request.userName && request.userName.toLowerCase().includes(searchTerm)) ||
          (request.binanceId && request.binanceId.toLowerCase().includes(searchTerm)) ||
          (request.requestId && request.requestId.toLowerCase().includes(searchTerm))
        );
      }
      
      if (filteredRequests.length === 0) {
        requestsList.innerHTML = `
          <div class="no-requests">
            <div class="no-requests-icon" style="color: var(--warning);">
              <i class="fab fa-binance"></i>
            </div>
            <div class="no-requests-title">لا توجد طلبات سحب قيد الانتظار</div>
            <div class="no-requests-text">
              ${currentAllPendingWithdrawsSearch ? 'لم يتم العثور على طلبات تطابق بحثك' : 'لا توجد طلبات سحب قيد الانتظار لعرضها'}
            </div>
          </div>
        `;
        return;
      }
      
      filteredRequests.forEach(request => {
        const requestCard = document.createElement('div');
        requestCard.className = `request-card ${request.status}`;
        
        const date = request.createdAt ? formatDate(request.createdAt) : '-';
        const amountText = formatCurrency(request.amount, request.currency);
        const feesText = formatCurrency(request.fees, request.currency);
        const netAmountText = formatCurrency(request.netAmount, request.currency);
        const statusText = getStatusText(request.status);
        const statusClass = getStatusClass(request.status);
        const userInitial = request.userName ? request.userName.charAt(0) : 'م';
        
        requestCard.innerHTML = `
          <div class="request-header">
            <div class="request-id">
              <i class="fab fa-binance"></i>
              ${request.requestId || request.id.substring(0, 8)}...
            </div>
            <div class="request-status ${statusClass}">
              ${statusText}
            </div>
          </div>
          
          <div class="request-content">
            <!-- معلومات المستخدم -->
            <div class="request-info">
              <div class="info-label">
                <i class="fas fa-user"></i>
                المستخدم
              </div>
              <div class="info-value info-user">
                <div class="user-avatar binance">${userInitial}</div>
                <div class="user-info">
                  <div class="user-name">${request.userName || 'مستخدم'}</div>
                  <div class="user-id">ID: ${request.userId}</div>
                </div>
              </div>
            </div>
            
            <!-- المبلغ -->
            <div class="request-info">
              <div class="info-label">
                <i class="fas fa-money-bill-wave"></i>
                المبلغ
              </div>
              <div class="info-value info-amount">${amountText}</div>
            </div>
            
            <!-- الرسوم -->
            <div class="request-info">
              <div class="info-label">
                <i class="fas fa-percentage"></i>
                الرسوم
              </div>
              <div class="info-value">${feesText}</div>
            </div>
            
            <!-- المبلغ الصافي -->
            <div class="request-info">
              <div class="info-label">
                <i class="fas fa-coins"></i>
                المبلغ الصافي
              </div>
              <div class="info-value">${netAmountText}</div>
            </div>
            
            <!-- معرف Binance -->
            <div class="request-info">
              <div class="info-label">
                <i class="fab fa-binance"></i>
                معرف Binance
              </div>
              <div class="info-value" style="font-family: 'Courier New', monospace; font-size: 11px;">
                ${request.binanceId}
              </div>
            </div>
            
            <!-- التاريخ -->
            <div class="request-info">
              <div class="info-label">
                <i class="fas fa-calendar"></i>
                تاريخ الطلب
              </div>
              <div class="info-value">${date}</div>
            </div>
            
            <!-- ملاحظات المستخدم -->
            <div class="request-info">
              <div class="info-label">
                <i class="fas fa-sticky-note"></i>
                ملاحظات المستخدم
              </div>
              <div class="info-value">
                ${request.notes ? request.notes.substring(0, 40) + (request.notes.length > 40 ? '...' : '') : 'لا توجد'}
              </div>
            </div>
          </div>
          
          <div class="request-actions">
            <button class="action-btn view binance" data-id="${request.id}" data-type="withdraw">
              <i class="fas fa-eye"></i>
              عرض التفاصيل
            </button>
            
            <button class="action-btn approve" data-id="${request.id}" data-type="withdraw">
              <i class="fas fa-check"></i>
              تأكيد
            </button>
            
            <button class="action-btn reject" data-id="${request.id}" data-type="withdraw">
              <i class="fas fa-times"></i>
              رفض
            </button>
          </div>
        `;
        
        requestsList.appendChild(requestCard);
      });
      
      // إضافة الأحداث للأزرار
      document.querySelectorAll('#allPendingWithdrawsList .action-btn.view[data-type="withdraw"]').forEach(btn => {
        btn.addEventListener('click', function() {
          const requestId = this.getAttribute('data-id');
          const type = this.getAttribute('data-type');
          showWithdrawRequestDetails(requestId, type);
        });
      });
      
      document.querySelectorAll('#allPendingWithdrawsList .action-btn.approve[data-type="withdraw"]').forEach(btn => {
        btn.addEventListener('click', function() {
          const requestId = this.getAttribute('data-id');
          const type = this.getAttribute('data-type');
          showWithdrawRequestDetails(requestId, type, 'approve');
        });
      });
      
      document.querySelectorAll('#allPendingWithdrawsList .action-btn.reject[data-type="withdraw"]').forEach(btn => {
        btn.addEventListener('click', function() {
          const requestId = this.getAttribute('data-id');
          const type = this.getAttribute('data-type');
          showWithdrawRequestDetails(requestId, type, 'reject');
        });
      });
    }

    function renderAllRejectedWithdrawsList(requests) {
      const requestsList = document.getElementById('allRejectedWithdrawsList');
      requestsList.innerHTML = '';
      
      let filteredRequests = requests;
      
      // تطبيق البحث
      if (currentAllRejectedWithdrawsSearch.trim() !== '') {
        const searchTerm = currentAllRejectedWithdrawsSearch.toLowerCase();
        filteredRequests = filteredRequests.filter(request => 
          request.id.toLowerCase().includes(searchTerm) ||
          (request.userName && request.userName.toLowerCase().includes(searchTerm)) ||
          (request.binanceId && request.binanceId.toLowerCase().includes(searchTerm)) ||
          (request.requestId && request.requestId.toLowerCase().includes(searchTerm))
        );
      }
      
      if (filteredRequests.length === 0) {
        requestsList.innerHTML = `
          <div class="no-requests">
            <div class="no-requests-icon" style="color: var(--danger);">
              <i class="fas fa-times-circle"></i>
            </div>
            <div class="no-requests-title">لا توجد طلبات سحب مرفوضة</div>
            <div class="no-requests-text">
              ${currentAllRejectedWithdrawsSearch ? 'لم يتم العثور على طلبات تطابق بحثك' : 'لا توجد طلبات سحب مرفوضة لعرضها'}
            </div>
          </div>
        `;
        return;
      }
      
      filteredRequests.forEach(request => {
        const requestCard = document.createElement('div');
        requestCard.className = `request-card ${request.status}`;
        
        const date = request.createdAt ? formatDate(request.createdAt) : '-';
        const amountText = formatCurrency(request.amount, request.currency);
        const feesText = formatCurrency(request.fees, request.currency);
        const netAmountText = formatCurrency(request.netAmount, request.currency);
        const refundAmountText = formatCurrency(request.refundAmount, request.currency);
        const statusText = getStatusText(request.status);
        const statusClass = getStatusClass(request.status);
        const userInitial = request.userName ? request.userName.charAt(0) : 'م';
        
        requestCard.innerHTML = `
          <div class="request-header">
            <div class="request-id">
              <i class="fab fa-binance"></i>
              ${request.requestId || request.id.substring(0, 8)}...
            </div>
            <div class="request-status ${statusClass}">
              ${statusText}
            </div>
          </div>
          
          <div class="request-content">
            <!-- معلومات المستخدم -->
            <div class="request-info">
              <div class="info-label">
                <i class="fas fa-user"></i>
                المستخدم
              </div>
              <div class="info-value info-user">
                <div class="user-avatar binance">${userInitial}</div>
                <div class="user-info">
                  <div class="user-name">${request.userName || 'مستخدم'}</div>
                  <div class="user-id">ID: ${request.userId}</div>
                </div>
              </div>
            </div>
            
            <!-- المبلغ -->
            <div class="request-info">
              <div class="info-label">
                <i class="fas fa-money-bill-wave"></i>
                المبلغ
              </div>
              <div class="info-value info-amount">${amountText}</div>
            </div>
            
            <!-- الرسوم -->
            <div class="request-info">
              <div class="info-label">
                <i class="fas fa-percentage"></i>
                الرسوم
              </div>
              <div class="info-value">${feesText}</div>
            </div>
            
            <!-- المبلغ الصافي -->
            <div class="request-info">
              <div class="info-label">
                <i class="fas fa-coins"></i>
                المبلغ الصافي
              </div>
              <div class="info-value">${netAmountText}</div>
            </div>
            
            <!-- المبلغ المسترجع -->
            <div class="request-info">
              <div class="info-label">
                <i class="fas fa-redo"></i>
                المبلغ المسترجع
              </div>
              <div class="info-value">${refundAmountText || 'لم يتم التحديد'}</div>
            </div>
            
            <!-- معرف Binance -->
            <div class="request-info">
              <div class="info-label">
                <i class="fab fa-binance"></i>
                معرف Binance
              </div>
              <div class="info-value" style="font-family: 'Courier New', monospace; font-size: 11px;">
                ${request.binanceId}
              </div>
            </div>
            
            <!-- التاريخ -->
            <div class="request-info">
              <div class="info-label">
                <i class="fas fa-calendar"></i>
                تاريخ الطلب
              </div>
              <div class="info-value">${date}</div>
            </div>
            
            <!-- ملاحظات المسؤول -->
            <div class="request-info">
              <div class="info-label">
                <i class="fas fa-sticky-note"></i>
                ملاحظات المسؤول
              </div>
              <div class="info-value">
                ${request.adminNotes ? request.adminNotes.substring(0, 40) + (request.adminNotes.length > 40 ? '...' : '') : 'لا توجد'}
              </div>
            </div>
          </div>
          
          <div class="request-actions">
            <button class="action-btn view binance" data-id="${request.id}" data-type="withdraw">
              <i class="fas fa-eye"></i>
              عرض التفاصيل
            </button>
          </div>
        `;
        
        requestsList.appendChild(requestCard);
      });
      
      // إضافة الأحداث للأزرار
      document.querySelectorAll('#allRejectedWithdrawsList .action-btn.view[data-type="withdraw"]').forEach(btn => {
        btn.addEventListener('click', function() {
          const requestId = this.getAttribute('data-id');
          const type = this.getAttribute('data-type');
          showWithdrawRequestDetails(requestId, type);
        });
      });
    }

    async function showDepositRequestDetails(requestId, type, action = null) {
      try {
        showLoading();
        
        const requestRef = db.collection('deposit_requests').doc(requestId);
        const requestDoc = await requestRef.get();
        
        if (!requestDoc.exists) {
          throw new Error('طلب الإيداع غير موجود');
        }
        
        const requestData = requestDoc.data();
        currentRequestId = requestId;
        currentRequestType = type;
        
        // تعبئة البيانات
        document.getElementById('depositModalRequestId').textContent = requestId.substring(0, 12) + '...';
        document.getElementById('depositModalUserName').textContent = requestData.userName || 'مستخدم';
        document.getElementById('depositModalUserId').textContent = requestData.userId;
        document.getElementById('depositModalAmount').textContent = formatCurrency(requestData.amount, requestData.currency);
        document.getElementById('depositModalTransferType').textContent = getTransferTypeText(requestData.transferType);
        document.getElementById('depositModalTransactionNumber').textContent = requestData.transactionNumber;
        document.getElementById('depositModalUserNotes').textContent = requestData.notes || 'لا توجد';
        document.getElementById('depositModalCreatedAt').textContent = formatDate(requestData.createdAt);
        document.getElementById('depositModalUpdatedAt').textContent = formatDate(requestData.updatedAt);
        
        // تحديث الحالة
        const statusElement = document.getElementById('depositModalStatus');
        statusElement.textContent = getStatusText(requestData.status);
        statusElement.className = `status-badge ${getStatusClass(requestData.status)}`;
        
        // عرض ملاحظات المسؤول إذا كانت موجودة
        if (requestData.adminNotes) {
          document.getElementById('depositAdminNotesSection').style.display = 'block';
          document.getElementById('depositModalAdminNotes').textContent = requestData.adminNotes;
        } else {
          document.getElementById('depositAdminNotesSection').style.display = 'none';
        }
        
        // التحكم في عرض نموذج الإجراء
        const actionForm = document.getElementById('depositActionForm');
        if (requestData.status === 'pending' && action) {
          actionForm.style.display = 'block';
          document.getElementById('depositAdminNotesInput').value = '';
          
          // إخفاء الزر المناسب حسب الإجراء
          if (action === 'approve') {
            document.getElementById('rejectDepositRequestBtn').style.display = 'flex';
            document.getElementById('approveDepositRequestBtn').style.display = 'flex';
          } else if (action === 'reject') {
            document.getElementById('rejectDepositRequestBtn').style.display = 'flex';
            document.getElementById('approveDepositRequestBtn').style.display = 'flex';
          }
        } else {
          actionForm.style.display = 'none';
        }
        
        hideLoading();
        openDepositModal();
        
      } catch (error) {
        console.error('❌ خطأ في عرض تفاصيل الطلب:', error);
        showToast('❌ خطأ في عرض التفاصيل', 'error');
        hideLoading();
      }
    }

    async function showWithdrawRequestDetails(requestId, type, action = null) {
      try {
        showLoading();
        
        const requestRef = db.collection('withdraw_requests').doc(requestId);
        const requestDoc = await requestRef.get();
        
        if (!requestDoc.exists) {
          throw new Error('طلب السحب غير موجود');
        }
        
        const requestData = requestDoc.data();
        
        // التحقق مما إذا كان الطلب قيد المعالجة
        if (processingRequests.has(requestId)) {
          showToast('⚠️ هذا الطلب قيد المعالجة حالياً. الرجاء الانتظار حتى تكتمل العملية.', 'warning');
          hideLoading();
          return;
        }
        
        currentRequestId = requestId;
        currentRequestType = type;
        
        // تعبئة البيانات
        document.getElementById('withdrawModalRequestId').textContent = requestData.requestId || requestId.substring(0, 12) + '...';
        document.getElementById('withdrawModalUserName').textContent = requestData.userName || 'مستخدم';
        document.getElementById('withdrawModalUserId').textContent = requestData.userId;
        document.getElementById('withdrawModalAmount').textContent = formatCurrency(requestData.amount, requestData.currency);
        document.getElementById('withdrawModalFees').textContent = formatCurrency(requestData.fees, requestData.currency);
        document.getElementById('withdrawModalNetAmount').textContent = formatCurrency(requestData.netAmount, requestData.currency);
        document.getElementById('withdrawModalBinanceId').textContent = requestData.binanceId;
        document.getElementById('withdrawModalCreatedAt').textContent = formatDate(requestData.createdAt);
        document.getElementById('withdrawModalUpdatedAt').textContent = formatDate(requestData.updatedAt);
        document.getElementById('withdrawModalAdminNotes').textContent = requestData.adminNotes || 'لا توجد';
        
        // تحديث الحالة
        const statusElement = document.getElementById('withdrawModalStatus');
        statusElement.textContent = getStatusText(requestData.status);
        statusElement.className = `status-badge ${getStatusClass(requestData.status)}`;
        
        // التحكم في عرض نموذج الإجراء
        const actionForm = document.getElementById('withdrawActionForm');
        if (requestData.status === 'pending' && action) {
          actionForm.style.display = 'block';
          document.getElementById('withdrawAdminNotesInput').value = '';
          
          // إخفاء الزر المناسب حسب الإجراء
          if (action === 'approve') {
            document.getElementById('rejectWithdrawRequestBtn').style.display = 'flex';
            document.getElementById('approveWithdrawRequestBtn').style.display = 'flex';
          } else if (action === 'reject') {
            document.getElementById('rejectWithdrawRequestBtn').style.display = 'flex';
            document.getElementById('approveWithdrawRequestBtn').style.display = 'flex';
          }
        } else {
          actionForm.style.display = 'none';
        }
        
        hideLoading();
        openWithdrawModal();
        
      } catch (error) {
        console.error('❌ خطأ في عرض تفاصيل طلب السحب:', error);
        showToast('❌ خطأ في عرض التفاصيل', 'error');
        hideLoading();
      }
    }

    // ========== دوال التحكم في النوافذ ==========
    function openDepositModal() {
      document.getElementById('depositRequestModal').style.display = 'flex';
    }

    function closeDepositModal() {
      document.getElementById('depositRequestModal').style.display = 'none';
      currentRequestId = null;
      currentRequestType = null;
      document.getElementById('depositAdminNotesInput').value = '';
    }

    function openWithdrawModal() {
      document.getElementById('withdrawRequestModal').style.display = 'flex';
    }

    function closeWithdrawModal() {
      document.getElementById('withdrawRequestModal').style.display = 'none';
      currentRequestId = null;
      currentRequestType = null;
      document.getElementById('withdrawAdminNotesInput').value = '';
    }

    // ========== دوال عرض واجهات مختلفة ==========
    function showAllWithdrawsView() {
      // إخفاء لوحة التحكم الرئيسية
      document.getElementById('adminContainer').style.display = 'none';
      
      // إخفاء واجهة طلبات الإيداع المرفوضة إذا كانت مفتوحة
      document.getElementById('allRejectedDepositsContainer').style.display = 'none';
      
      // إخفاء واجهة طلبات الإيداع قيد الانتظار إذا كانت مفتوحة
      document.getElementById('allPendingDepositsContainer').style.display = 'none';
      
      // إخفاء واجهة طلبات الإيداع المؤكدة إذا كانت مفتوحة
      document.getElementById('allApprovedDepositsContainer').style.display = 'none';
      
      // إخفاء واجهة طلبات السحب المؤكدة إذا كانت مفتوحة
      document.getElementById('allApprovedWithdrawsContainer').style.display = 'none';
      
      // إخفاء واجهة طلبات السحب قيد الانتظار إذا كانت مفتوحة
      document.getElementById('allPendingWithdrawsContainer').style.display = 'none';
      
      // إخفاء واجهة طلبات السحب المرفوضة إذا كانت مفتوحة
      document.getElementById('allRejectedWithdrawsContainer').style.display = 'none';
      
      // إظهار واجهة جميع طلبات السحب
      document.getElementById('allWithdrawsContainer').style.display = 'block';
      
      // بدء الاستماع لطلبات السحب
      setupAllWithdrawsListener();
      
      showToast('تم فتح واجهة جميع طلبات السحب', 'binance');
    }

    function showAllRejectedDepositsView() {
      // إخفاء لوحة التحكم الرئيسية
      document.getElementById('adminContainer').style.display = 'none';
      
      // إخفاء واجهة جميع طلبات السحب إذا كانت مفتوحة
      document.getElementById('allWithdrawsContainer').style.display = 'none';
      
      // إخفاء واجهة طلبات الإيداع قيد الانتظار إذا كانت مفتوحة
      document.getElementById('allPendingDepositsContainer').style.display = 'none';
      
      // إخفاء واجهة طلبات الإيداع المؤكدة إذا كانت مفتوحة
      document.getElementById('allApprovedDepositsContainer').style.display = 'none';
      
      // إخفاء واجهة طلبات السحب المؤكدة إذا كانت مفتوحة
      document.getElementById('allApprovedWithdrawsContainer').style.display = 'none';
      
      // إخفاء واجهة طلبات السحب قيد الانتظار إذا كانت مفتوحة
      document.getElementById('allPendingWithdrawsContainer').style.display = 'none';
      
      // إخفاء واجهة طلبات السحب المرفوضة إذا كانت مفتوحة
      document.getElementById('allRejectedWithdrawsContainer').style.display = 'none';
      
      // إظهار واجهة جميع طلبات الإيداع المرفوضة
      document.getElementById('allRejectedDepositsContainer').style.display = 'block';
      
      // بدء الاستماع لطلبات الإيداع المرفوضة
      setupAllRejectedDepositsListener();
      
      showToast('تم فتح واجهة جميع طلبات الإيداع المرفوضة', 'error');
    }

    function showAllPendingDepositsView() {
      // إخفاء لوحة التحكم الرئيسية
      document.getElementById('adminContainer').style.display = 'none';
      
      // إخفاء واجهة جميع طلبات السحب إذا كانت مفتوحة
      document.getElementById('allWithdrawsContainer').style.display = 'none';
      
      // إخفاء واجهة جميع طلبات الإيداع المرفوضة إذا كانت مفتوحة
      document.getElementById('allRejectedDepositsContainer').style.display = 'none';
      
      // إخفاء واجهة طلبات الإيداع المؤكدة إذا كانت مفتوحة
      document.getElementById('allApprovedDepositsContainer').style.display = 'none';
      
      // إخفاء واجهة طلبات السحب المؤكدة إذا كانت مفتوحة
      document.getElementById('allApprovedWithdrawsContainer').style.display = 'none';
      
      // إخفاء واجهة طلبات السحب قيد الانتظار إذا كانت مفتوحة
      document.getElementById('allPendingWithdrawsContainer').style.display = 'none';
      
      // إخفاء واجهة طلبات السحب المرفوضة إذا كانت مفتوحة
      document.getElementById('allRejectedWithdrawsContainer').style.display = 'none';
      
      // إظهار واجهة جميع طلبات الإيداع قيد الانتظار
      document.getElementById('allPendingDepositsContainer').style.display = 'block';
      
      // بدء الاستماع لطلبات الإيداع قيد الانتظار
      setupAllPendingDepositsListener();
      
      showToast('تم فتح واجهة جميع طلبات الإيداع قيد الانتظار', 'warning');
    }

    function showAllApprovedDepositsView() {
      // إخفاء لوحة التحكم الرئيسية
      document.getElementById('adminContainer').style.display = 'none';
      
      // إخفاء واجهة جميع طلبات السحب إذا كانت مفتوحة
      document.getElementById('allWithdrawsContainer').style.display = 'none';
      
      // إخفاء واجهة جميع طلبات الإيداع المرفوضة إذا كانت مفتوحة
      document.getElementById('allRejectedDepositsContainer').style.display = 'none';
      
      // إخفاء واجهة طلبات الإيداع قيد الانتظار إذا كانت مفتوحة
      document.getElementById('allPendingDepositsContainer').style.display = 'none';
      
      // إخفاء واجهة طلبات السحب المؤكدة إذا كانت مفتوحة
      document.getElementById('allApprovedWithdrawsContainer').style.display = 'none';
      
      // إخفاء واجهة طلبات السحب قيد الانتظار إذا كانت مفتوحة
      document.getElementById('allPendingWithdrawsContainer').style.display = 'none';
      
      // إخفاء واجهة طلبات السحب المرفوضة إذا كانت مفتوحة
      document.getElementById('allRejectedWithdrawsContainer').style.display = 'none';
      
      // إظهار واجهة جميع طلبات الإيداع المؤكدة
      document.getElementById('allApprovedDepositsContainer').style.display = 'block';
      
      // بدء الاستماع لطلبات الإيداع المؤكدة
      setupAllApprovedDepositsListener();
      
      showToast('تم فتح واجهة جميع طلبات الإيداع المؤكدة', 'success');
    }

    function showAllApprovedWithdrawsView() {
      // إخفاء لوحة التحكم الرئيسية
      document.getElementById('adminContainer').style.display = 'none';
      
      // إخفاء واجهة جميع طلبات السحب إذا كانت مفتوحة
      document.getElementById('allWithdrawsContainer').style.display = 'none';
      
      // إخفاء واجهة جميع طلبات الإيداع المرفوضة إذا كانت مفتوحة
      document.getElementById('allRejectedDepositsContainer').style.display = 'none';
      
      // إخفاء واجهة طلبات الإيداع قيد الانتظار إذا كانت مفتوحة
      document.getElementById('allPendingDepositsContainer').style.display = 'none';
      
      // إخفاء واجهة طلبات الإيداع المؤكدة إذا كانت مفتوحة
      document.getElementById('allApprovedDepositsContainer').style.display = 'none';
      
      // إخفاء واجهة طلبات السحب قيد الانتظار إذا كانت مفتوحة
      document.getElementById('allPendingWithdrawsContainer').style.display = 'none';
      
      // إخفاء واجهة طلبات السحب المرفوضة إذا كانت مفتوحة
      document.getElementById('allRejectedWithdrawsContainer').style.display = 'none';
      
      // إظهار واجهة جميع طلبات السحب المؤكدة
      document.getElementById('allApprovedWithdrawsContainer').style.display = 'block';
      
      // بدء الاستماع لطلبات السحب المؤكدة
      setupAllApprovedWithdrawsListener();
      
      showToast('تم فتح واجهة جميع طلبات السحب المؤكدة', 'success');
    }

    function showAllPendingWithdrawsView() {
      // إخفاء لوحة التحكم الرئيسية
      document.getElementById('adminContainer').style.display = 'none';
      
      // إخفاء جميع الواجهات الأخرى
      document.getElementById('allWithdrawsContainer').style.display = 'none';
      document.getElementById('allRejectedDepositsContainer').style.display = 'none';
      document.getElementById('allPendingDepositsContainer').style.display = 'none';
      document.getElementById('allApprovedDepositsContainer').style.display = 'none';
      document.getElementById('allApprovedWithdrawsContainer').style.display = 'none';
      document.getElementById('allRejectedWithdrawsContainer').style.display = 'none';
      
      // إظهار واجهة جميع طلبات السحب قيد الانتظار
      document.getElementById('allPendingWithdrawsContainer').style.display = 'block';
      
      // بدء الاستماع لطلبات السحب قيد الانتظار
      setupAllPendingWithdrawsListener();
      
      showToast('تم فتح واجهة جميع طلبات السحب قيد الانتظار', 'warning');
    }

    function showAllRejectedWithdrawsView() {
      // إخفاء لوحة التحكم الرئيسية
      document.getElementById('adminContainer').style.display = 'none';
      
      // إخفاء جميع الواجهات الأخرى
      document.getElementById('allWithdrawsContainer').style.display = 'none';
      document.getElementById('allRejectedDepositsContainer').style.display = 'none';
      document.getElementById('allPendingDepositsContainer').style.display = 'none';
      document.getElementById('allApprovedDepositsContainer').style.display = 'none';
      document.getElementById('allApprovedWithdrawsContainer').style.display = 'none';
      document.getElementById('allPendingWithdrawsContainer').style.display = 'none';
      
      // إظهار واجهة جميع طلبات السحب المرفوضة
      document.getElementById('allRejectedWithdrawsContainer').style.display = 'block';
      
      // بدء الاستماع لطلبات السحب المرفوضة
      setupAllRejectedWithdrawsListener();
      
      showToast('تم فتح واجهة جميع طلبات السحب المرفوضة', 'error');
    }

    function showMainDashboard() {
      // إخفاء جميع واجهات العرض التفصيلية
      document.getElementById('allWithdrawsContainer').style.display = 'none';
      document.getElementById('allRejectedDepositsContainer').style.display = 'none';
      document.getElementById('allPendingDepositsContainer').style.display = 'none';
      document.getElementById('allApprovedDepositsContainer').style.display = 'none';
      document.getElementById('allApprovedWithdrawsContainer').style.display = 'none';
      document.getElementById('allPendingWithdrawsContainer').style.display = 'none';
      document.getElementById('allRejectedWithdrawsContainer').style.display = 'none';
      
      // إظهار لوحة التحكم الرئيسية
      document.getElementById('adminContainer').style.display = 'block';
      
      // إيقاف جميع المستمعين للواجهات التفصيلية
      const listeners = [
        allWithdrawsListener,
        allRejectedDepositsListener,
        allPendingDepositsListener,
        allApprovedDepositsListener,
        allApprovedWithdrawsListener,
        allPendingWithdrawsListener,
        allRejectedWithdrawsListener
      ];
      
      listeners.forEach(listener => {
        if (listener) {
          listener();
        }
      });
      
      // إعادة تعيين جميع المستمعين
      allWithdrawsListener = null;
      allRejectedDepositsListener = null;
      allPendingDepositsListener = null;
      allApprovedDepositsListener = null;
      allApprovedWithdrawsListener = null;
      allPendingWithdrawsListener = null;
      allRejectedWithdrawsListener = null;
      
      // إعادة تحميل إحصائية الطلبات
      setupRealtimeDepositListener();
      setupRealtimeWithdrawListener();
      
      showToast('تم العودة للوحة التحكم الرئيسية', 'success');
    }

    // ========== دوال تسجيل الدخول ==========
    function login() {
      const username = document.getElementById('usernameInput').value.trim();
      const password = document.getElementById('passwordInput').value;
      const loginError = document.getElementById('loginError');
      
      if (username === ADMIN_CREDENTIALS.username && password === ADMIN_CREDENTIALS.password) {
        loginError.style.display = 'none';
        
        // حفظ حالة تسجيل الدخول
        localStorage.setItem('adminLoggedIn', 'true');
        
        // الانتقال للوحة التحكم
        document.getElementById('loginContainer').style.display = 'none';
        document.getElementById('adminContainer').style.display = 'block';
        
        // إعداد الاستماع للطلبات
        setupRealtimeDepositListener();
        setupRealtimeWithdrawListener();
        
        // حساب إجمالي الأرصدة
        calculateTotalBalance();
        
        showToast('✅ تم تسجيل الدخول بنجاح', 'success');
      } else {
        loginError.style.display = 'block';
        document.getElementById('passwordInput').value = '';
      }
    }

    function logout() {
      if (confirm('هل تريد تسجيل الخروج؟')) {
        localStorage.removeItem('adminLoggedIn');
        location.reload();
      }
    }

    // ========== تهيئة الأحداث ==========
    document.addEventListener('DOMContentLoaded', function() {
      console.log('🚀 تهيئة لوحة تحكم المسؤول...');
      
      // التحقق من تسجيل الدخول السابق
      if (localStorage.getItem('adminLoggedIn') === 'true') {
        document.getElementById('loginContainer').style.display = 'none';
        document.getElementById('adminContainer').style.display = 'block';
        setupRealtimeDepositListener();
        setupRealtimeWithdrawListener();
        calculateTotalBalance();
      } else {
        document.getElementById('loginContainer').style.display = 'flex';
        document.getElementById('adminContainer').style.display = 'none';
      }
      
      // أحداث تسجيل الدخول
      document.getElementById('loginBtn').addEventListener('click', login);
      document.getElementById('passwordInput').addEventListener('keypress', function(e) {
        if (e.key === 'Enter') login();
      });
      
      // أحداث تسجيل الخروج
      document.getElementById('logoutBtn').addEventListener('click', logout);
      
      // أحداث الفلاتر لجميع طلبات السحب
      document.querySelectorAll('.filter-btn.binance[data-type="withdraw"]').forEach(button => {
        button.addEventListener('click', function() {
          // معرفة إذا كنا في واجهة جميع طلبات السحب
          const isInAllWithdraws = document.getElementById('allWithdrawsContainer').style.display === 'block';
          
          if (isInAllWithdraws) {
            document.querySelectorAll('.filter-btn.binance[data-type="withdraw"]').forEach(btn => btn.classList.remove('active'));
            this.classList.add('active');
            currentAllWithdrawsFilter = this.getAttribute('data-filter');
            
            // إعادة تحميل جميع طلبات السحب مع الفلتر الجديد
            setupAllWithdrawsListener();
          }
        });
      });
      
      // أحداث الفلاتر لجميع طلبات الإيداع المرفوضة
      document.querySelectorAll('.filter-btn.rejected[data-type="all-rejected-deposits"]').forEach(button => {
        button.addEventListener('click', function() {
          // معرفة إذا كنا في واجهة جميع طلبات الإيداع المرفوضة
          const isInAllRejectedDeposits = document.getElementById('allRejectedDepositsContainer').style.display === 'block';
          
          if (isInAllRejectedDeposits) {
            document.querySelectorAll('.filter-btn.rejected[data-type="all-rejected-deposits"]').forEach(btn => btn.classList.remove('active'));
            this.classList.add('active');
            currentAllRejectedDepositsFilter = this.getAttribute('data-filter');
            
            // إعادة تحميل جميع طلبات الإيداع المرفوضة مع الفلتر الجديد
            setupAllRejectedDepositsListener();
          }
        });
      });
      
      // أحداث الفلاتر لجميع طلبات الإيداع قيد الانتظار
      document.querySelectorAll('.filter-btn.pending[data-type="all-pending-deposits"]').forEach(button => {
        button.addEventListener('click', function() {
          // معرفة إذا كنا في واجهة جميع طلبات الإيداع قيد الانتظار
          const isInAllPendingDeposits = document.getElementById('allPendingDepositsContainer').style.display === 'block';
          
          if (isInAllPendingDeposits) {
            document.querySelectorAll('.filter-btn.pending[data-type="all-pending-deposits"]').forEach(btn => btn.classList.remove('active'));
            this.classList.add('active');
            currentAllPendingDepositsFilter = this.getAttribute('data-filter');
            
            // إعادة تحميل جميع طلبات الإيداع قيد الانتظار مع الفلتر الجديد
            setupAllPendingDepositsListener();
          }
        });
      });
      
      // أحداث الفلاتر لجميع طلبات الإيداع المؤكدة
      document.querySelectorAll('.filter-btn.approved[data-type="all-approved-deposits"]').forEach(button => {
        button.addEventListener('click', function() {
          // معرفة إذا كنا في واجهة جميع طلبات الإيداع المؤكدة
          const isInAllApprovedDeposits = document.getElementById('allApprovedDepositsContainer').style.display === 'block';
          
          if (isInAllApprovedDeposits) {
            document.querySelectorAll('.filter-btn.approved[data-type="all-approved-deposits"]').forEach(btn => btn.classList.remove('active'));
            this.classList.add('active');
            currentAllApprovedDepositsFilter = this.getAttribute('data-filter');
            
            // إعادة تحميل جميع طلبات الإيداع المؤكدة مع الفلتر الجديد
            setupAllApprovedDepositsListener();
          }
        });
      });
      
      // أحداث الفلاتر لجميع طلبات السحب المؤكدة
      document.querySelectorAll('.filter-btn.binance.approved[data-type="all-approved-withdraws"]').forEach(button => {
        button.addEventListener('click', function() {
          // معرفة إذا كنا في واجهة جميع طلبات السحب المؤكدة
          const isInAllApprovedWithdraws = document.getElementById('allApprovedWithdrawsContainer').style.display === 'block';
          
          if (isInAllApprovedWithdraws) {
            document.querySelectorAll('.filter-btn.binance.approved[data-type="all-approved-withdraws"]').forEach(btn => btn.classList.remove('active'));
            this.classList.add('active');
            currentAllApprovedWithdrawsFilter = this.getAttribute('data-filter');
            
            // إعادة تحميل جميع طلبات السحب المؤكدة مع الفلتر الجديد
            setupAllApprovedWithdrawsListener();
          }
        });
      });
      
      // أحداث الفلاتر لطلبات السحب قيد الانتظار
      document.querySelectorAll('.filter-btn.binance.pending[data-type="all-pending-withdraws"]').forEach(button => {
        button.addEventListener('click', function() {
          const isInAllPendingWithdraws = document.getElementById('allPendingWithdrawsContainer').style.display === 'block';
          
          if (isInAllPendingWithdraws) {
            document.querySelectorAll('.filter-btn.binance.pending[data-type="all-pending-withdraws"]').forEach(btn => btn.classList.remove('active'));
            this.classList.add('active');
            currentAllPendingWithdrawsFilter = this.getAttribute('data-filter');
            
            setupAllPendingWithdrawsListener();
          }
        });
      });
      
      // أحداث الفلاتر لطلبات السحب المرفوضة
      document.querySelectorAll('.filter-btn.binance.rejected[data-type="all-rejected-withdraws"]').forEach(button => {
        button.addEventListener('click', function() {
          const isInAllRejectedWithdraws = document.getElementById('allRejectedWithdrawsContainer').style.display === 'block';
          
          if (isInAllRejectedWithdraws) {
            document.querySelectorAll('.filter-btn.binance.rejected[data-type="all-rejected-withdraws"]').forEach(btn => btn.classList.remove('active'));
            this.classList.add('active');
            currentAllRejectedWithdrawsFilter = this.getAttribute('data-filter');
            
            setupAllRejectedWithdrawsListener();
          }
        });
      });
      
      // حدث البحث في جميع طلبات السحب
      document.getElementById('allWithdrawsSearchInput').addEventListener('input', function() {
        currentAllWithdrawsSearch = this.value;
        setupAllWithdrawsListener();
      });
      
      // حدث البحث في جميع طلبات الإيداع المرفوضة
      document.getElementById('allRejectedDepositsSearchInput').addEventListener('input', function() {
        currentAllRejectedDepositsSearch = this.value;
        setupAllRejectedDepositsListener();
      });
      
      // حدث البحث في جميع طلبات الإيداع قيد الانتظار
      document.getElementById('allPendingDepositsSearchInput').addEventListener('input', function() {
        currentAllPendingDepositsSearch = this.value;
        setupAllPendingDepositsListener();
      });
      
      // حدث البحث في جميع طلبات الإيداع المؤكدة
      document.getElementById('allApprovedDepositsSearchInput').addEventListener('input', function() {
        currentAllApprovedDepositsSearch = this.value;
        setupAllApprovedDepositsListener();
      });
      
      // حدث البحث في جميع طلبات السحب المؤكدة
      document.getElementById('allApprovedWithdrawsSearchInput').addEventListener('input', function() {
        currentAllApprovedWithdrawsSearch = this.value;
        setupAllApprovedWithdrawsListener();
      });
      
      // حدث البحث في جميع طلبات السحب قيد الانتظار
      document.getElementById('allPendingWithdrawsSearchInput').addEventListener('input', function() {
        currentAllPendingWithdrawsSearch = this.value;
        setupAllPendingWithdrawsListener();
      });
      
      // حدث البحث في جميع طلبات السحب المرفوضة
      document.getElementById('allRejectedWithdrawsSearchInput').addEventListener('input', function() {
        currentAllRejectedWithdrawsSearch = this.value;
        setupAllRejectedWithdrawsListener();
      });
      
      // أحداث نافذة تفاصيل طلب الإيداع
      document.getElementById('closeDepositModalBtn').addEventListener('click', closeDepositModal);
      document.getElementById('cancelDepositActionBtn').addEventListener('click', closeDepositModal);
      
      document.getElementById('approveDepositRequestBtn').addEventListener('click', function() {
        if (!currentRequestId) return;
        
        const adminNotes = document.getElementById('depositAdminNotesInput').value.trim();
        updateDepositStatus(currentRequestId, 'approved', adminNotes);
      });
      
      document.getElementById('rejectDepositRequestBtn').addEventListener('click', function() {
        if (!currentRequestId) return;
        
        const adminNotes = document.getElementById('depositAdminNotesInput').value.trim();
        updateDepositStatus(currentRequestId, 'rejected', adminNotes);
      });
      
      // أحداث نافذة تفاصيل طلب السحب
      document.getElementById('closeWithdrawModalBtn').addEventListener('click', closeWithdrawModal);
      document.getElementById('cancelWithdrawActionBtn').addEventListener('click', closeWithdrawModal);
      
      document.getElementById('approveWithdrawRequestBtn').addEventListener('click', function() {
        if (!currentRequestId) return;
        
        const adminNotes = document.getElementById('withdrawAdminNotesInput').value.trim();
        updateWithdrawStatus(currentRequestId, 'approved', adminNotes);
      });
      
      document.getElementById('rejectWithdrawRequestBtn').addEventListener('click', function() {
        if (!currentRequestId) return;
        
        const adminNotes = document.getElementById('withdrawAdminNotesInput').value.trim();
        updateWithdrawStatus(currentRequestId, 'rejected', adminNotes);
      });
      
      // إغلاق النوافذ بالنقر خارجها
      document.getElementById('depositRequestModal').addEventListener('click', function(e) {
        if (e.target === this) {
          closeDepositModal();
        }
      });
      
      document.getElementById('withdrawRequestModal').addEventListener('click', function(e) {
        if (e.target === this) {
          closeWithdrawModal();
        }
      });
      
      // ========== حدث الضغط على بطاقة إجمالي طلبات السحب ==========
      // تمت إزالة هذه البطاقة من الواجهة الرئيسية
      
      // ========== حدث الضغط على بطاقة طلبات الإيداع المرفوضة ==========
      document.getElementById('totalRejectedCard').addEventListener('click', function() {
        showAllRejectedDepositsView();
      });
      
      // ========== حدث الضغط على بطاقة طلبات الإيداع قيد الانتظار ==========
      document.getElementById('totalPendingCard').addEventListener('click', function() {
        showAllPendingDepositsView();
      });
      
      // ========== حدث الضغط على بطاقة طلبات الإيداع المؤكدة ==========
      document.getElementById('totalApprovedCard').addEventListener('click', function() {
        showAllApprovedDepositsView();
      });
      
      // ========== حدث الضغط على بطاقة طلبات السحب المؤكدة ==========
      document.getElementById('totalApprovedWithdrawCard').addEventListener('click', function() {
        showAllApprovedWithdrawsView();
      });
      
      // ========== حدث الضغط على بطاقة طلبات السحب قيد الانتظار ==========
      document.getElementById('totalPendingWithdrawCard').addEventListener('click', function() {
        showAllPendingWithdrawsView();
      });
      
      // ========== حدث الضغط على بطاقة طلبات السحب المرفوضة ==========
      document.getElementById('totalRejectedWithdrawCard').addEventListener('click', function() {
        showAllRejectedWithdrawsView();
      });
      
      // ========== حدث العودة للوحة التحكم ==========
      document.getElementById('backToDashboardBtn').addEventListener('click', function() {
        showMainDashboard();
      });
      
      // ========== حدث العودة للوحة التحكم من واجهة طلبات الإيداع المرفوضة ==========
      document.getElementById('backToDashboardFromRejectedBtn').addEventListener('click', function() {
        showMainDashboard();
      });
      
      // ========== حدث العودة للوحة التحكم من واجهة طلبات الإيداع قيد الانتظار ==========
      document.getElementById('backToDashboardFromPendingBtn').addEventListener('click', function() {
        showMainDashboard();
      });
      
      // ========== حدث العودة للوحة التحكم من واجهة طلبات الإيداع المؤكدة ==========
      document.getElementById('backToDashboardFromApprovedBtn').addEventListener('click', function() {
        showMainDashboard();
      });
      
      // ========== حدث العودة للوحة التحكم من واجهة طلبات السحب المؤكدة ==========
      document.getElementById('backToDashboardFromApprovedWithdrawBtn').addEventListener('click', function() {
        showMainDashboard();
      });
      
      // ========== حدث العودة للوحة التحكم من واجهة طلبات السحب قيد الانتظار ==========
      document.getElementById('backToDashboardFromPendingWithdrawBtn').addEventListener('click', function() {
        showMainDashboard();
      });
      
      // ========== حدث العودة للوحة التحكم من واجهة طلبات السحب المرفوضة ==========
      document.getElementById('backToDashboardFromRejectedWithdrawBtn').addEventListener('click', function() {
        showMainDashboard();
      });
    });
  </script>
</body>
</html>
